{"version":3,"sources":["../../../../node_modules/eventemitter3/index.js","../../src/index.ts","../../../../node_modules/eventemitter3/index.mjs","../../src/highlighting/SimpleHighlighter.ts","../../src/search/SearchEngine.ts","../../src/highlighting/TextLayerHighlighter.ts","../../src/search/TextLayerSearchEngine.ts","../../src/highlighting/SelectionHighlightEngine.ts","../../src/rendering/PDFRenderer.ts","../../src/SalinaPDFViewer.ts","../../src/highlighting/HighlightEngine.ts","../../src/utils/helpers.ts","../../src/utils/performance.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","// Main exports\nexport { SalinaPDFViewer } from \"./SalinaPDFViewer\";\n\n// Type exports\nexport type {\n  SalinaPDFViewerOptions,\n  Highlight,\n  SearchResult,\n  PDFPage,\n  ViewerState,\n  SalinaPDFPlugin,\n  EventMap,\n} from \"./types\";\n\nexport type { ActiveHighlight } from \"./highlighting/SimpleHighlighter\";\nexport type { HighlightOptions } from \"./highlighting/HighlightEngine\";  \nexport type { SelectionHighlightOptions, SelectionHighlight } from \"./highlighting/SelectionHighlightEngine\";\nexport type { TextLayerMatch } from \"./highlighting/TextLayerHighlighter\";\nexport type { SearchOptions, TextContent } from \"./search/SearchEngine\";\nexport type { TextLayerSearchOptions } from \"./search/TextLayerSearchEngine\";\n\n// Engine exports\nexport { SimpleHighlighter } from \"./highlighting/SimpleHighlighter\";\nexport { HighlightEngine } from \"./highlighting/HighlightEngine\";\nexport { SelectionHighlightEngine } from \"./highlighting/SelectionHighlightEngine\";\nexport { TextLayerHighlighter } from \"./highlighting/TextLayerHighlighter\";\nexport { SearchEngine } from \"./search/SearchEngine\";\nexport { TextLayerSearchEngine } from \"./search/TextLayerSearchEngine\";\nexport { PDFRenderer } from \"./rendering/PDFRenderer\";\n\n// Utility exports\nexport * from \"./utils/helpers\";\nexport {\n  PerformanceOptimizer,\n  MemoryManager,\n  VirtualScrolling,\n} from \"./utils/performance\";\n\n// Version\nexport const VERSION = \"3.0.2\";\n","import EventEmitter from './index.js'\n\nexport { EventEmitter }\nexport default EventEmitter\n","import type { ViewerState } from \"../types\";\n\nexport interface SimpleHighlighterOptions {\n  highlightColor: string;\n  copyHintEnabled: boolean;\n}\n\nexport interface HighlightRectangle {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface ActiveHighlight {\n  pageNumber: number;\n  text: string;\n  rectangles: HighlightRectangle[];\n  timestamp: number;\n}\n\nexport class SimpleHighlighter {\n  private options: SimpleHighlighterOptions;\n  private activeHighlight: ActiveHighlight | null = null;\n  private highlightElements: HTMLElement[] = [];\n  private copyHintElement: HTMLElement | null = null;\n  private scale: number = 1.0;\n\n  constructor(options: SimpleHighlighterOptions) {\n    this.options = options;\n    this.setupEventListeners();\n  }\n\n  updateScale(scale: number): void {\n    this.scale = scale;\n    this.rerenderHighlights();\n  }\n\n  private setupEventListeners(): void {\n    // Handle mouse up for text selection\n    document.addEventListener(\"mouseup\", this.handleMouseUp.bind(this));\n\n    // Handle clicks to clear highlights\n    document.addEventListener(\"click\", this.handleDocumentClick.bind(this));\n\n    // Handle escape key\n    document.addEventListener(\"keydown\", this.handleKeyDown.bind(this));\n  }\n\n  private handleMouseUp(): void {\n    // Small delay to ensure selection is stable\n    setTimeout(() => {\n      const selection = window.getSelection();\n\n      if (\n        !selection ||\n        !selection.toString().trim() ||\n        selection.rangeCount === 0\n      ) {\n        return;\n      }\n\n      const selectedText = selection.toString().trim();\n      const range = selection.getRangeAt(0);\n\n      // Find which page this selection belongs to\n      const pageNumber = this.findPageNumber(range);\n      if (!pageNumber) return;\n\n      const pageContainer = document.getElementById(`page-${pageNumber}`);\n      if (!pageContainer) return;\n\n      // Check if the selection is within the text layer\n      const textLayer =\n        pageContainer.querySelector(\".react-pdf__Page__textContent\") ||\n        pageContainer.querySelector(\".salina-pdf-text-layer\");\n      if (!textLayer) return;\n\n      const startContainer = range.startContainer;\n      const endContainer = range.endContainer;\n      const commonAncestor = range.commonAncestorContainer;\n\n      const isWithinTextLayer =\n        textLayer.contains(startContainer) ||\n        textLayer.contains(endContainer) ||\n        textLayer.contains(commonAncestor);\n\n      if (!isWithinTextLayer) return;\n\n      // Create highlights from selection\n      const rectangles = this.createHighlightRectangles(range, pageContainer);\n\n      if (rectangles.length > 0) {\n        this.setActiveHighlight({\n          pageNumber,\n          text: selectedText,\n          rectangles,\n          timestamp: Date.now(),\n        });\n\n        // Clear the browser selection\n        setTimeout(() => {\n          selection.removeAllRanges();\n        }, 10);\n      }\n    }, 10);\n  }\n\n  private handleDocumentClick(e: MouseEvent): void {\n    const target = e.target as HTMLElement;\n\n    // Don't clear if clicking on copy hint\n    if (target.closest(\".salina-copy-hint\")) {\n      return;\n    }\n\n    // Clear highlights if clicking outside the active page or on non-text areas\n    if (this.activeHighlight) {\n      const pageContainer = document.getElementById(\n        `page-${this.activeHighlight.pageNumber}`\n      );\n\n      if (!pageContainer?.contains(target)) {\n        this.clearHighlights();\n        return;\n      }\n\n      const textLayer =\n        pageContainer.querySelector(\".react-pdf__Page__textContent\") ||\n        pageContainer.querySelector(\".salina-pdf-text-layer\");\n\n      if (\n        textLayer &&\n        !textLayer.contains(target) &&\n        !target.closest(\".salina-highlight\")\n      ) {\n        this.clearHighlights();\n      }\n    }\n  }\n\n  private handleKeyDown(e: KeyboardEvent): void {\n    if (e.key === \"Escape\") {\n      this.clearHighlights();\n    } else if (\n      (e.ctrlKey || e.metaKey) &&\n      e.key === \"c\" &&\n      this.activeHighlight\n    ) {\n      e.preventDefault();\n      this.copyToClipboard();\n    }\n  }\n\n  private findPageNumber(range: Range): number | null {\n    // Look for page container in the range hierarchy\n    let element = range.commonAncestorContainer;\n\n    while (element && element !== document) {\n      if (element.nodeType === Node.ELEMENT_NODE) {\n        const el = element as Element;\n\n        // Check for page container with id pattern\n        if (el.id && el.id.match(/^page-\\d+$/)) {\n          return parseInt(el.id.replace(\"page-\", \"\"));\n        }\n\n        // Check for page container with data attribute\n        const pageAttr = el.getAttribute(\"data-page-number\");\n        if (pageAttr) {\n          return parseInt(pageAttr);\n        }\n\n        // Look for parent page container\n        const pageContainer =\n          el.closest('[id^=\"page-\"]') || el.closest(\"[data-page-number]\");\n        if (pageContainer) {\n          if (pageContainer.id && pageContainer.id.match(/^page-\\d+$/)) {\n            return parseInt(pageContainer.id.replace(\"page-\", \"\"));\n          }\n          const pageAttr = pageContainer.getAttribute(\"data-page-number\");\n          if (pageAttr) {\n            return parseInt(pageAttr);\n          }\n        }\n      }\n\n      element = element.parentNode;\n    }\n\n    return null;\n  }\n\n  private createHighlightRectangles(\n    range: Range,\n    pageContainer: HTMLElement\n  ): HighlightRectangle[] {\n    const pageRect = pageContainer.getBoundingClientRect();\n    const rects = range.getClientRects();\n    const rectangles: HighlightRectangle[] = [];\n\n    Array.from(rects).forEach((rect) => {\n      if (rect.width > 0 && rect.height > 0) {\n        const relativeX = rect.left - pageRect.left;\n        const relativeY = rect.top - pageRect.top;\n\n        rectangles.push({\n          x: relativeX / this.scale,\n          y: relativeY / this.scale,\n          width: rect.width / this.scale,\n          height: rect.height / this.scale,\n        });\n      }\n    });\n\n    return rectangles;\n  }\n\n  private setActiveHighlight(highlight: ActiveHighlight): void {\n    this.clearHighlights();\n    this.activeHighlight = highlight;\n    this.renderHighlights();\n\n    if (this.options.copyHintEnabled) {\n      this.renderCopyHint();\n    }\n  }\n\n  private renderHighlights(): void {\n    if (!this.activeHighlight) return;\n\n    const pageContainer = document.getElementById(\n      `page-${this.activeHighlight.pageNumber}`\n    );\n    if (!pageContainer) return;\n\n    this.activeHighlight.rectangles.forEach((rect, index) => {\n      const highlightElement = document.createElement(\"div\");\n      highlightElement.className = \"salina-highlight salina-simple-highlight\";\n      highlightElement.setAttribute(\n        \"data-page\",\n        this.activeHighlight!.pageNumber.toString()\n      );\n      highlightElement.title = this.activeHighlight!.text;\n\n      Object.assign(highlightElement.style, {\n        position: \"absolute\",\n        left: `${rect.x * this.scale}px`,\n        top: `${rect.y * this.scale}px`,\n        width: `${rect.width * this.scale}px`,\n        height: `${rect.height * this.scale}px`,\n        backgroundColor: this.options.highlightColor,\n        borderRadius: \"2px\",\n        pointerEvents: \"none\",\n        zIndex: \"5\",\n        mixBlendMode: \"multiply\",\n        transition: \"background-color 0.2s ease\",\n      });\n\n      pageContainer.appendChild(highlightElement);\n      this.highlightElements.push(highlightElement);\n    });\n  }\n\n  private renderCopyHint(): void {\n    if (!this.activeHighlight || this.activeHighlight.rectangles.length === 0)\n      return;\n\n    const pageContainer = document.getElementById(\n      `page-${this.activeHighlight.pageNumber}`\n    );\n    if (!pageContainer) return;\n\n    const firstRect = this.activeHighlight.rectangles[0];\n\n    const copyHint = document.createElement(\"div\");\n    copyHint.className = \"salina-copy-hint\";\n\n    Object.assign(copyHint.style, {\n      position: \"absolute\",\n      left: `${firstRect.x * this.scale}px`,\n      top: `${(firstRect.y - 30) * this.scale}px`,\n      zIndex: \"10\",\n      animation: \"fadeIn 0.3s ease-out\",\n      pointerEvents: \"auto\",\n    });\n\n    const bubble = document.createElement(\"div\");\n    bubble.className = \"salina-copy-hint-bubble\";\n    bubble.textContent = \"📋 Copy (Ctrl+C)\";\n\n    Object.assign(bubble.style, {\n      background: \"rgba(0, 0, 0, 0.8)\",\n      color: \"white\",\n      padding: \"4px 8px\",\n      borderRadius: \"4px\",\n      fontSize: \"12px\",\n      fontFamily:\n        '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n      cursor: \"pointer\",\n      userSelect: \"none\",\n      whiteSpace: \"nowrap\",\n      boxShadow: \"0 2px 8px rgba(0, 0, 0, 0.3)\",\n      transition: \"all 0.2s ease\",\n      opacity: \"0.9\",\n    });\n\n    bubble.addEventListener(\"click\", this.copyToClipboard.bind(this));\n    bubble.addEventListener(\"mouseenter\", () => {\n      bubble.style.background = \"rgba(0, 0, 0, 0.9)\";\n      bubble.style.opacity = \"1\";\n      bubble.style.transform = \"translateY(-1px)\";\n    });\n    bubble.addEventListener(\"mouseleave\", () => {\n      bubble.style.background = \"rgba(0, 0, 0, 0.8)\";\n      bubble.style.opacity = \"0.9\";\n      bubble.style.transform = \"translateY(0)\";\n    });\n\n    copyHint.appendChild(bubble);\n    pageContainer.appendChild(copyHint);\n    this.copyHintElement = copyHint;\n  }\n\n  private async copyToClipboard(): Promise<void> {\n    if (!this.activeHighlight) return;\n\n    try {\n      await navigator.clipboard.writeText(this.activeHighlight.text);\n      console.log(\n        \"Highlighted text copied to clipboard:\",\n        this.activeHighlight.text\n      );\n\n      // Show visual feedback\n      this.highlightElements.forEach((element) => {\n        element.classList.add(\"copied\");\n        element.style.backgroundColor = \"rgba(0, 255, 0, 0.6)\";\n        element.style.transform = \"scale(1.02)\";\n\n        setTimeout(() => {\n          element.classList.remove(\"copied\");\n          element.style.backgroundColor = this.options.highlightColor;\n          element.style.transform = \"scale(1)\";\n        }, 500);\n      });\n    } catch (err) {\n      console.error(\"Failed to copy text:\", err);\n    }\n  }\n\n  private rerenderHighlights(): void {\n    if (this.activeHighlight) {\n      this.clearHighlights();\n      this.renderHighlights();\n      if (this.options.copyHintEnabled) {\n        this.renderCopyHint();\n      }\n    }\n  }\n\n  clearHighlights(): void {\n    // Remove highlight elements\n    this.highlightElements.forEach((element) => {\n      element.remove();\n    });\n    this.highlightElements = [];\n\n    // Remove copy hint\n    if (this.copyHintElement) {\n      this.copyHintElement.remove();\n      this.copyHintElement = null;\n    }\n\n    this.activeHighlight = null;\n  }\n\n  getActiveHighlight(): ActiveHighlight | null {\n    return this.activeHighlight;\n  }\n\n  destroy(): void {\n    this.clearHighlights();\n    document.removeEventListener(\"mouseup\", this.handleMouseUp.bind(this));\n    document.removeEventListener(\"click\", this.handleDocumentClick.bind(this));\n    document.removeEventListener(\"keydown\", this.handleKeyDown.bind(this));\n  }\n}\n","import type { SearchResult } from \"../types\";\n\nexport interface SearchOptions {\n  highlightColor: string;\n  caseSensitive: boolean;\n  wholeWords: boolean;\n}\n\nexport interface TextContent {\n  pageNumber: number;\n  items: Array<{\n    str: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  }>;\n}\n\n// Security: Add regex validation and timeout protection\nconst MAX_REGEX_LENGTH = 100;\nconst SEARCH_TIMEOUT_MS = 5000;\nconst DANGEROUS_REGEX_PATTERNS = [\n  /(\\.\\*){2,}/, // Multiple .* patterns\n  /(\\+\\*)|(\\*\\+)/, // Catastrophic backtracking patterns\n  /(.*){2,}/, // Nested quantifiers\n  /(\\(.+\\+){2,}/, // Nested groups with quantifiers\n];\n\nfunction validateSearchQuery(query: string): boolean {\n  // Prevent excessively long queries\n  if (query.length > MAX_REGEX_LENGTH) {\n    return false;\n  }\n\n  // Check for dangerous regex patterns\n  const escapedQuery = query.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n  const testPattern = `\\\\b${escapedQuery}\\\\b`;\n\n  return !DANGEROUS_REGEX_PATTERNS.some((pattern) => pattern.test(testPattern));\n}\n\nfunction createSafeRegex(searchQuery: string): RegExp | null {\n  try {\n    if (!validateSearchQuery(searchQuery)) {\n      console.warn(\"Search query rejected for security reasons\");\n      return null;\n    }\n\n    const escapedQuery = searchQuery.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n    return new RegExp(`\\\\b${escapedQuery}\\\\b`, \"g\");\n  } catch (error) {\n    console.warn(\"Invalid regex pattern:\", error);\n    return null;\n  }\n}\n\nexport class SearchEngine {\n  private searchResults: SearchResult[] = [];\n  private searchElements: HTMLElement[] = [];\n  private options: SearchOptions;\n\n  constructor(options: SearchOptions) {\n    this.options = options;\n  }\n\n  search(query: string, textContent: TextContent[]): SearchResult[] {\n    this.clearResults();\n\n    if (!query.trim()) return [];\n\n    const results: SearchResult[] = [];\n    let globalIndex = 0;\n\n    // Optimize search by preprocessing query once\n    const searchQuery = this.options.caseSensitive\n      ? query\n      : query.toLowerCase();\n\n    // Security: Use safe regex construction with validation\n    const regex = this.options.wholeWords ? createSafeRegex(searchQuery) : null;\n\n    // If regex creation failed due to security concerns, fall back to simple search\n    if (this.options.wholeWords && !regex) {\n      console.warn(\n        \"Falling back to simple search due to invalid regex pattern\"\n      );\n      // Continue with simple indexOf search instead of returning empty results\n    }\n\n    textContent.forEach((pageContent) => {\n      pageContent.items.forEach((item) => {\n        // Skip empty items early\n        if (!item.str.trim()) return;\n\n        const text = this.options.caseSensitive\n          ? item.str\n          : item.str.toLowerCase();\n        const indices = this.findMatchIndices(text, searchQuery, regex);\n\n        indices.forEach(({ index, length }) => {\n          results.push({\n            pageNumber: pageContent.pageNumber,\n            text: item.str.substr(index, length),\n            position: {\n              x: item.x,\n              y: item.y,\n              width: item.width,\n              height: item.height,\n            },\n            textIndex: globalIndex,\n            context: this.getContext(item.str, index, length),\n          });\n          globalIndex++;\n        });\n      });\n    });\n\n    this.searchResults = results;\n    this.renderSearchResultsOptimized();\n    return results;\n  }\n\n  private findMatchIndices(\n    text: string,\n    searchQuery: string,\n    regex: RegExp | null\n  ): Array<{ index: number; length: number }> {\n    const matches: Array<{ index: number; length: number }> = [];\n\n    if (regex) {\n      regex.lastIndex = 0; // Reset regex state\n      let match;\n      let iterationCount = 0;\n      const maxIterations = 10000; // Prevent infinite loops\n\n      while (\n        (match = regex.exec(text)) !== null &&\n        iterationCount < maxIterations\n      ) {\n        matches.push({ index: match.index, length: match[0].length });\n        iterationCount++;\n\n        // Break infinite loop protection\n        if (match.index === regex.lastIndex) {\n          regex.lastIndex++;\n        }\n      }\n    } else {\n      let index = text.indexOf(searchQuery);\n      let iterationCount = 0;\n      const maxIterations = 10000; // Prevent infinite loops\n\n      while (index !== -1 && iterationCount < maxIterations) {\n        matches.push({ index, length: searchQuery.length });\n        index = text.indexOf(searchQuery, index + 1);\n        iterationCount++;\n      }\n    }\n\n    return matches;\n  }\n\n  clearResults(): void {\n    this.searchResults = [];\n    this.clearSearchHighlights();\n  }\n\n  getResults(): SearchResult[] {\n    return this.searchResults;\n  }\n\n  destroy(): void {\n    this.clearResults();\n  }\n\n  private renderSearchResultsOptimized(): void {\n    // Group results by page for batch DOM operations\n    const resultsByPage = new Map<number, SearchResult[]>();\n\n    this.searchResults.forEach((result, index) => {\n      if (!resultsByPage.has(result.pageNumber)) {\n        resultsByPage.set(result.pageNumber, []);\n      }\n      resultsByPage\n        .get(result.pageNumber)!\n        .push({ ...result, originalIndex: index } as any);\n    });\n\n    // Render highlights for each page in batch\n    resultsByPage.forEach((pageResults, pageNumber) => {\n      this.renderPageHighlights(pageNumber, pageResults);\n    });\n  }\n\n  private renderPageHighlights(pageNumber: number, results: any[]): void {\n    const pageContainer = document.querySelector(\n      `[data-page-number=\"${pageNumber}\"]`\n    ) as HTMLElement;\n\n    if (!pageContainer) return;\n\n    const fragment = document.createDocumentFragment();\n\n    results.forEach((result) => {\n      const highlightElement = document.createElement(\"div\");\n      highlightElement.className = \"salina-search-highlight\";\n      highlightElement.setAttribute(\n        \"data-search-index\",\n        result.originalIndex.toString()\n      );\n\n      // Use CSS class for styling instead of inline styles for better performance\n      highlightElement.style.cssText = `\n        position: absolute;\n        left: ${result.position.x}px;\n        top: ${result.position.y}px;\n        width: ${result.position.width}px;\n        height: ${result.position.height}px;\n        background-color: ${this.options.highlightColor};\n        pointer-events: none;\n        border-radius: 2px;\n        z-index: 15;\n        mix-blend-mode: multiply;\n      `;\n\n      fragment.appendChild(highlightElement);\n      this.searchElements.push(highlightElement);\n    });\n\n    pageContainer.appendChild(fragment);\n  }\n\n  private clearSearchHighlights(): void {\n    this.searchElements.forEach((element) => element.remove());\n    this.searchElements = [];\n  }\n\n  private getContext(text: string, index: number, length: number): string {\n    const contextLength = 50;\n    const start = Math.max(0, index - contextLength);\n    const end = Math.min(text.length, index + length + contextLength);\n\n    let context = text.substring(start, end);\n\n    if (start > 0) context = \"...\" + context;\n    if (end < text.length) context = context + \"...\";\n\n    return context;\n  }\n\n  private escapeRegExp(string: string): string {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n  }\n\n  highlightSearchResult(index: number): void {\n    // Remove previous highlighting\n    this.searchElements.forEach((el) => el.classList.remove(\"current\"));\n\n    // Highlight current result\n    const element = this.searchElements[index];\n    if (element) {\n      element.classList.add(\"current\");\n      element.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n    }\n  }\n}\n","import type { SearchResult } from '../types'\n\nexport interface TextLayerMatch {\n  pageIndex: number\n  matchIndex: number\n  textDivs: HTMLElement[]\n  textContent: string\n  begin: { divIdx: number; offset: number }\n  end: { divIdx: number; offset: number }\n}\n\n/**\n * PDF.js-style text layer highlighter that works with native browser selection\n * and text layer spans for pixel-perfect highlighting\n */\nexport class TextLayerHighlighter {\n  private matches: Map<string, TextLayerMatch[]> = new Map()\n  private selectedMatchIndex: number = -1\n  private highlightClassName = 'salina-highlight'\n  private selectedClassName = 'salina-highlight-selected'\n  \n  /**\n   * Find all text matches in a text layer using PDF.js approach\n   */\n  findTextInLayer(\n    textLayer: HTMLElement,\n    query: string,\n    caseSensitive: boolean = false\n  ): TextLayerMatch[] {\n    const textDivs = Array.from(textLayer.querySelectorAll('span')) as HTMLElement[]\n    const matches: TextLayerMatch[] = []\n    \n    if (!textDivs.length || !query) return matches\n    \n    const pageText = textDivs.map(div => div.textContent || '').join('')\n    const searchQuery = caseSensitive ? query : query.toLowerCase()\n    const searchText = caseSensitive ? pageText : pageText.toLowerCase()\n    \n    let matchIndex = 0\n    let searchIndex = 0\n    \n    while ((searchIndex = searchText.indexOf(searchQuery, searchIndex)) !== -1) {\n      // Find which divs contain this match\n      const matchEnd = searchIndex + searchQuery.length\n      \n      let charCount = 0\n      let beginDiv = -1\n      let beginOffset = -1\n      let endDiv = -1\n      let endOffset = -1\n      \n      for (let divIdx = 0; divIdx < textDivs.length; divIdx++) {\n        const divText = textDivs[divIdx].textContent || ''\n        const divLength = divText.length\n        \n        if (beginDiv === -1 && charCount + divLength > searchIndex) {\n          beginDiv = divIdx\n          beginOffset = searchIndex - charCount\n        }\n        \n        if (charCount < matchEnd && charCount + divLength >= matchEnd) {\n          endDiv = divIdx\n          endOffset = matchEnd - charCount\n          break\n        }\n        \n        charCount += divLength\n      }\n      \n      if (beginDiv !== -1 && endDiv !== -1) {\n        const matchDivs = textDivs.slice(beginDiv, endDiv + 1)\n        \n        matches.push({\n          pageIndex: parseInt(textLayer.dataset.pageNumber || '0'),\n          matchIndex: matchIndex++,\n          textDivs: matchDivs,\n          textContent: pageText.substring(searchIndex, matchEnd),\n          begin: { divIdx: beginDiv, offset: beginOffset },\n          end: { divIdx: endDiv, offset: endOffset }\n        })\n      }\n      \n      searchIndex = matchEnd\n    }\n    \n    return matches\n  }\n  \n  /**\n   * Highlight matches using PDF.js approach with wrapped text nodes\n   */\n  highlightMatches(matches: TextLayerMatch[], highlightAll: boolean = true): void {\n    const pageMatches = new Map<number, TextLayerMatch[]>()\n    \n    // Group matches by page\n    matches.forEach(match => {\n      if (!pageMatches.has(match.pageIndex)) {\n        pageMatches.set(match.pageIndex, [])\n      }\n      pageMatches.get(match.pageIndex)!.push(match)\n    })\n    \n    // Highlight each page's matches\n    pageMatches.forEach((pageMatchList, pageIndex) => {\n      this.highlightPageMatches(pageMatchList, highlightAll)\n    })\n  }\n  \n  private highlightPageMatches(matches: TextLayerMatch[], highlightAll: boolean): void {\n    // Sort matches by position to handle overlaps correctly\n    matches.sort((a, b) => {\n      if (a.begin.divIdx !== b.begin.divIdx) {\n        return a.begin.divIdx - b.begin.divIdx\n      }\n      return a.begin.offset - b.begin.offset\n    })\n    \n    // Process each match\n    matches.forEach((match, index) => {\n      this.highlightMatch(match, highlightAll || index === this.selectedMatchIndex)\n    })\n  }\n  \n  private highlightMatch(match: TextLayerMatch, isSelected: boolean = false): void {\n    const { begin, end, textDivs } = match\n    \n    if (begin.divIdx === end.divIdx) {\n      // Match within single div\n      this.highlightTextRange(\n        textDivs[0],\n        begin.offset,\n        end.offset,\n        isSelected\n      )\n    } else {\n      // Match spans multiple divs\n      for (let i = 0; i < textDivs.length; i++) {\n        const div = textDivs[i]\n        \n        if (i === 0) {\n          // First div: highlight from offset to end\n          this.highlightTextRange(\n            div,\n            begin.offset,\n            div.textContent!.length,\n            isSelected\n          )\n        } else if (i === textDivs.length - 1) {\n          // Last div: highlight from start to offset\n          this.highlightTextRange(div, 0, end.offset, isSelected)\n        } else {\n          // Middle divs: highlight entirely\n          this.highlightTextRange(div, 0, div.textContent!.length, isSelected)\n        }\n      }\n    }\n  }\n  \n  private highlightTextRange(\n    element: HTMLElement,\n    start: number,\n    end: number,\n    isSelected: boolean\n  ): void {\n    const text = element.textContent || ''\n    if (start >= end || start < 0 || end > text.length) return\n    \n    const textNode = element.firstChild as Text\n    if (!textNode || textNode.nodeType !== Node.TEXT_NODE) return\n    \n    // Create highlight wrapper\n    const highlightSpan = document.createElement('span')\n    highlightSpan.className = this.highlightClassName\n    if (isSelected) {\n      highlightSpan.classList.add(this.selectedClassName)\n    }\n    \n    // Handle text node splitting for partial highlights\n    if (start > 0) {\n      textNode.splitText(start)\n    }\n    \n    const highlightedNode = textNode.nextSibling as Text || textNode\n    if (end < text.length) {\n      highlightedNode.splitText(end - start)\n    }\n    \n    // Wrap the text node with highlight span\n    const highlightedText = highlightedNode.cloneNode(true)\n    highlightSpan.appendChild(highlightedText)\n    highlightedNode.parentNode!.replaceChild(highlightSpan, highlightedNode)\n  }\n  \n  /**\n   * Clear all highlights from text layers\n   */\n  clearHighlights(): void {\n    const highlights = document.querySelectorAll(`.${this.highlightClassName}`)\n    \n    highlights.forEach(highlight => {\n      const parent = highlight.parentNode\n      if (!parent) return\n      \n      // Extract text content and replace highlight span with text node\n      const text = highlight.textContent || ''\n      const textNode = document.createTextNode(text)\n      parent.replaceChild(textNode, highlight)\n      \n      // Normalize to merge adjacent text nodes\n      parent.normalize()\n    })\n    \n    this.matches.clear()\n    this.selectedMatchIndex = -1\n  }\n  \n  /**\n   * Navigate to specific match\n   */\n  navigateToMatch(matchIndex: number): void {\n    const allMatches = Array.from(this.matches.values()).flat()\n    \n    if (matchIndex < 0 || matchIndex >= allMatches.length) return\n    \n    // Clear previous selection\n    document.querySelectorAll(`.${this.selectedClassName}`).forEach(el => {\n      el.classList.remove(this.selectedClassName)\n    })\n    \n    // Highlight new selection\n    this.selectedMatchIndex = matchIndex\n    const match = allMatches[matchIndex]\n    \n    // Re-highlight with selection\n    this.highlightMatch(match, true)\n    \n    // Scroll into view\n    const firstDiv = match.textDivs[0]\n    firstDiv.scrollIntoView({ behavior: 'smooth', block: 'center' })\n  }\n  \n  /**\n   * Get selection from text layer for manual highlighting\n   */\n  getSelectionInfo(selection: Selection): {\n    text: string\n    range: Range\n    rects: DOMRect[]\n  } | null {\n    if (!selection.rangeCount) return null\n    \n    const range = selection.getRangeAt(0)\n    const text = selection.toString().trim()\n    \n    if (!text) return null\n    \n    // Get all client rects for the selection\n    const rects = Array.from(range.getClientRects())\n    \n    return {\n      text,\n      range,\n      rects\n    }\n  }\n  \n  /**\n   * Create persistent highlight from selection\n   */\n  createHighlightFromSelection(\n    selection: Selection,\n    color: string = 'yellow',\n    id?: string\n  ): string | null {\n    const selectionInfo = this.getSelectionInfo(selection)\n    if (!selectionInfo) return null\n    \n    const { range } = selectionInfo\n    const highlightId = id || `highlight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    \n    // Create highlight wrapper\n    const highlightSpan = document.createElement('span')\n    highlightSpan.className = 'salina-persistent-highlight'\n    highlightSpan.dataset.highlightId = highlightId\n    highlightSpan.style.backgroundColor = color\n    highlightSpan.style.opacity = '0.3'\n    highlightSpan.style.cursor = 'pointer'\n    \n    try {\n      // Wrap the range content with highlight span\n      range.surroundContents(highlightSpan)\n    } catch (e) {\n      // If surroundContents fails (e.g., range spans multiple elements),\n      // extract and wrap the contents\n      const contents = range.extractContents()\n      highlightSpan.appendChild(contents)\n      range.insertNode(highlightSpan)\n    }\n    \n    // Clear selection\n    selection.removeAllRanges()\n    \n    return highlightId\n  }\n  \n  /**\n   * Remove persistent highlight by ID\n   */\n  removeHighlight(highlightId: string): void {\n    const highlight = document.querySelector(`[data-highlight-id=\"${highlightId}\"]`)\n    if (!highlight) return\n    \n    const parent = highlight.parentNode\n    if (!parent) return\n    \n    // Move all child nodes out of highlight\n    while (highlight.firstChild) {\n      parent.insertBefore(highlight.firstChild, highlight)\n    }\n    \n    // Remove empty highlight element\n    highlight.remove()\n    \n    // Normalize to merge adjacent text nodes\n    parent.normalize()\n  }\n}","import type { SearchResult } from '../types'\nimport { TextLayerHighlighter, type TextLayerMatch } from '../highlighting/TextLayerHighlighter'\n\nexport interface TextLayerSearchOptions {\n  caseSensitive: boolean\n  wholeWords: boolean\n  highlightAll: boolean\n}\n\n/**\n * Enhanced search engine that uses PDF.js text layer for accurate highlighting\n */\nexport class TextLayerSearchEngine {\n  private highlighter: TextLayerHighlighter\n  private currentQuery: string = ''\n  private currentMatchIndex: number = -1\n  private matches: TextLayerMatch[] = []\n  private options: TextLayerSearchOptions\n  \n  constructor(options: Partial<TextLayerSearchOptions> = {}) {\n    this.highlighter = new TextLayerHighlighter()\n    this.options = {\n      caseSensitive: false,\n      wholeWords: false,\n      highlightAll: true,\n      ...options\n    }\n  }\n  \n  /**\n   * Search across all text layers\n   */\n  search(query: string): SearchResult[] {\n    this.clear()\n    \n    if (!query.trim()) return []\n    \n    this.currentQuery = query\n    const results: SearchResult[] = []\n    \n    // Find all text layers\n    const textLayers = document.querySelectorAll('.salina-pdf-text-layer') as NodeListOf<HTMLElement>\n    \n    textLayers.forEach(textLayer => {\n      const pageNumber = parseInt(textLayer.dataset.pageNumber || '0')\n      const matches = this.searchInTextLayer(textLayer, query)\n      \n      // Convert TextLayerMatch to SearchResult\n      matches.forEach((match, index) => {\n        const bounds = this.getMatchBounds(match)\n        results.push({\n          pageNumber,\n          text: match.textContent,\n          position: bounds,\n          textIndex: results.length,\n          context: this.getMatchContext(match)\n        })\n      })\n      \n      this.matches.push(...matches)\n    })\n    \n    // Highlight all matches if enabled\n    if (this.options.highlightAll && this.matches.length > 0) {\n      this.highlighter.highlightMatches(this.matches, true)\n    }\n    \n    return results\n  }\n  \n  private searchInTextLayer(textLayer: HTMLElement, query: string): TextLayerMatch[] {\n    let searchQuery = query\n    \n    // Handle whole words search\n    if (this.options.wholeWords) {\n      // For whole words, we'll check boundaries after finding matches\n      // This is more accurate than using regex on the concatenated text\n    }\n    \n    const matches = this.highlighter.findTextInLayer(\n      textLayer,\n      searchQuery,\n      this.options.caseSensitive\n    )\n    \n    // Filter for whole words if needed\n    if (this.options.wholeWords) {\n      return matches.filter(match => this.isWholeWordMatch(match))\n    }\n    \n    return matches\n  }\n  \n  private isWholeWordMatch(match: TextLayerMatch): boolean {\n    const { textDivs, begin, end } = match\n    \n    // Check start boundary\n    const startDiv = textDivs[0]\n    const startText = startDiv.textContent || ''\n    if (begin.offset > 0) {\n      const charBefore = startText[begin.offset - 1]\n      if (charBefore && /\\w/.test(charBefore)) {\n        return false\n      }\n    }\n    \n    // Check end boundary\n    const endDiv = textDivs[textDivs.length - 1]\n    const endText = endDiv.textContent || ''\n    if (end.offset < endText.length) {\n      const charAfter = endText[end.offset]\n      if (charAfter && /\\w/.test(charAfter)) {\n        return false\n      }\n    }\n    \n    return true\n  }\n  \n  private getMatchBounds(match: TextLayerMatch): {\n    x: number\n    y: number\n    width: number\n    height: number\n  } {\n    const rects: DOMRect[] = []\n    \n    // Collect bounding rects from all involved text divs\n    match.textDivs.forEach(div => {\n      const rect = div.getBoundingClientRect()\n      rects.push(rect)\n    })\n    \n    if (rects.length === 0) {\n      return { x: 0, y: 0, width: 0, height: 0 }\n    }\n    \n    // Calculate overall bounds\n    const bounds = {\n      x: Math.min(...rects.map(r => r.left)),\n      y: Math.min(...rects.map(r => r.top)),\n      width: 0,\n      height: 0\n    }\n    \n    const right = Math.max(...rects.map(r => r.right))\n    const bottom = Math.max(...rects.map(r => r.bottom))\n    \n    bounds.width = right - bounds.x\n    bounds.height = bottom - bounds.y\n    \n    // Convert to page-relative coordinates\n    const pageContainer = match.textDivs[0].closest('[data-page-number]')\n    if (pageContainer) {\n      const pageRect = pageContainer.getBoundingClientRect()\n      bounds.x -= pageRect.left\n      bounds.y -= pageRect.top\n    }\n    \n    return bounds\n  }\n  \n  private getMatchContext(match: TextLayerMatch, contextLength: number = 30): string {\n    const fullText = match.textDivs.map(div => div.textContent || '').join('')\n    const matchText = match.textContent\n    const matchStart = fullText.indexOf(matchText)\n    \n    if (matchStart === -1) return matchText\n    \n    const contextStart = Math.max(0, matchStart - contextLength)\n    const contextEnd = Math.min(fullText.length, matchStart + matchText.length + contextLength)\n    \n    let context = fullText.substring(contextStart, contextEnd)\n    \n    if (contextStart > 0) context = '...' + context\n    if (contextEnd < fullText.length) context = context + '...'\n    \n    return context\n  }\n  \n  /**\n   * Navigate to next/previous match\n   */\n  nextMatch(): void {\n    if (this.matches.length === 0) return\n    \n    this.currentMatchIndex = (this.currentMatchIndex + 1) % this.matches.length\n    this.highlighter.navigateToMatch(this.currentMatchIndex)\n  }\n  \n  previousMatch(): void {\n    if (this.matches.length === 0) return\n    \n    this.currentMatchIndex = this.currentMatchIndex - 1\n    if (this.currentMatchIndex < 0) {\n      this.currentMatchIndex = this.matches.length - 1\n    }\n    \n    this.highlighter.navigateToMatch(this.currentMatchIndex)\n  }\n  \n  /**\n   * Clear search results and highlights\n   */\n  clear(): void {\n    this.highlighter.clearHighlights()\n    this.matches = []\n    this.currentQuery = ''\n    this.currentMatchIndex = -1\n  }\n  \n  /**\n   * Update search options\n   */\n  setOptions(options: Partial<TextLayerSearchOptions>): void {\n    this.options = { ...this.options, ...options }\n    \n    // Re-run search if we have a current query\n    if (this.currentQuery) {\n      this.search(this.currentQuery)\n    }\n  }\n  \n  /**\n   * Get current match information\n   */\n  getCurrentMatch(): { index: number; total: number } | null {\n    if (this.matches.length === 0) return null\n    \n    return {\n      index: this.currentMatchIndex + 1,\n      total: this.matches.length\n    }\n  }\n  \n  destroy(): void {\n    this.clear()\n  }\n}","import type { Highlight } from '../types'\nimport { TextLayerHighlighter } from './TextLayerHighlighter'\n\nexport interface SelectionHighlight extends Highlight {\n  serializedRange?: string\n  rects: DOMRect[]\n}\n\nexport interface SelectionHighlightOptions {\n  defaultColor: string\n  allowMultipleColors: boolean\n  persistHighlights: boolean\n  autoHighlight: boolean\n}\n\n/**\n * Enhanced highlight engine that uses native browser selection and text layer\n * for pixel-perfect highlighting across zoom levels\n */\nexport class SelectionHighlightEngine {\n  private highlighter: TextLayerHighlighter\n  private highlights: Map<string, SelectionHighlight> = new Map()\n  private options: SelectionHighlightOptions\n  private selectionHandler: ((event: MouseEvent) => void) | null = null\n  \n  constructor(options: Partial<SelectionHighlightOptions> = {}) {\n    this.highlighter = new TextLayerHighlighter()\n    this.options = {\n      defaultColor: 'yellow',\n      allowMultipleColors: true,\n      persistHighlights: true,\n      autoHighlight: false,\n      ...options\n    }\n    \n    this.setupSelectionHandling()\n  }\n  \n  private setupSelectionHandling(): void {\n    if (!this.options.autoHighlight) return\n    \n    this.selectionHandler = (event: MouseEvent) => {\n      // Only handle mouse up events in text layers\n      const target = event.target as HTMLElement\n      if (!target.closest('.salina-pdf-text-layer')) return\n      \n      // Small delay to ensure selection is complete\n      setTimeout(() => {\n        const selection = window.getSelection()\n        if (selection && selection.toString().trim()) {\n          this.createHighlightFromCurrentSelection()\n        }\n      }, 10)\n    }\n    \n    document.addEventListener('mouseup', this.selectionHandler)\n  }\n  \n  /**\n   * Create highlight from current browser selection\n   */\n  createHighlightFromCurrentSelection(\n    color: string = this.options.defaultColor\n  ): SelectionHighlight | null {\n    const selection = window.getSelection()\n    if (!selection || !selection.rangeCount) return null\n    \n    const selectionInfo = this.highlighter.getSelectionInfo(selection)\n    if (!selectionInfo) return null\n    \n    // Determine which page the selection is on\n    const range = selection.getRangeAt(0)\n    const container = range.commonAncestorContainer\n    const textLayer = (container instanceof Element ? container : container.parentElement)\n      ?.closest('.salina-pdf-text-layer') as HTMLElement\n    \n    if (!textLayer) return null\n    \n    const pageNumber = parseInt(textLayer.dataset.pageNumber || '1')\n    \n    // Create highlight using text layer highlighter\n    const highlightId = this.highlighter.createHighlightFromSelection(selection, color)\n    if (!highlightId) return null\n    \n    // Create highlight object\n    const highlight: SelectionHighlight = {\n      id: highlightId,\n      text: selectionInfo.text,\n      color,\n      position: this.rectsToPosition(selectionInfo.rects, textLayer),\n      pageNumber,\n      timestamp: Date.now(),\n      rects: selectionInfo.rects,\n      serializedRange: this.serializeRange(range)\n    }\n    \n    // Store highlight\n    this.highlights.set(highlightId, highlight)\n    \n    // Add interaction handlers\n    this.addHighlightInteraction(highlightId)\n    \n    // Emit event\n    this.emitHighlightEvent('create', highlight)\n    \n    return highlight\n  }\n  \n  /**\n   * Convert DOMRects to position relative to page\n   */\n  private rectsToPosition(\n    rects: DOMRect[],\n    textLayer: HTMLElement\n  ): { x: number; y: number; width: number; height: number } {\n    if (rects.length === 0) {\n      return { x: 0, y: 0, width: 0, height: 0 }\n    }\n    \n    const pageRect = textLayer.getBoundingClientRect()\n    \n    // Calculate bounding box\n    const minX = Math.min(...rects.map(r => r.left)) - pageRect.left\n    const minY = Math.min(...rects.map(r => r.top)) - pageRect.top\n    const maxX = Math.max(...rects.map(r => r.right)) - pageRect.left\n    const maxY = Math.max(...rects.map(r => r.bottom)) - pageRect.top\n    \n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    }\n  }\n  \n  /**\n   * Serialize a range for persistence\n   */\n  private serializeRange(range: Range): string {\n    const startContainer = range.startContainer\n    const endContainer = range.endContainer\n    \n    // Find the path to the containers\n    const startPath = this.getNodePath(startContainer)\n    const endPath = this.getNodePath(endContainer)\n    \n    return JSON.stringify({\n      startPath,\n      startOffset: range.startOffset,\n      endPath,\n      endOffset: range.endOffset\n    })\n  }\n  \n  /**\n   * Get path to a node for serialization\n   */\n  private getNodePath(node: Node): number[] {\n    const path: number[] = []\n    let current: Node | null = node\n    \n    while (current && current.parentNode) {\n      const parent = current.parentNode\n      const index = Array.from(parent.childNodes).indexOf(current as ChildNode)\n      path.unshift(index)\n      current = parent\n      \n      // Stop at text layer\n      if (current instanceof Element && current.classList.contains('salina-pdf-text-layer')) {\n        break\n      }\n    }\n    \n    return path\n  }\n  \n  /**\n   * Restore highlights from serialized data\n   */\n  restoreHighlights(highlights: SelectionHighlight[]): void {\n    highlights.forEach(highlight => {\n      if (highlight.serializedRange) {\n        try {\n          const range = this.deserializeRange(highlight.serializedRange, highlight.pageNumber)\n          if (range) {\n            // Create selection and highlight\n            const selection = window.getSelection()\n            selection?.removeAllRanges()\n            selection?.addRange(range)\n            \n            this.highlighter.createHighlightFromSelection(\n              selection!,\n              highlight.color,\n              highlight.id\n            )\n            \n            selection?.removeAllRanges()\n            \n            // Store and setup interaction\n            this.highlights.set(highlight.id, highlight)\n            this.addHighlightInteraction(highlight.id)\n          }\n        } catch (e) {\n          console.warn('Failed to restore highlight:', e)\n        }\n      }\n    })\n  }\n  \n  /**\n   * Deserialize a range\n   */\n  private deserializeRange(serialized: string, pageNumber: number): Range | null {\n    try {\n      const data = JSON.parse(serialized)\n      const textLayer = document.querySelector(\n        `[data-page-number=\"${pageNumber}\"] .salina-pdf-text-layer`\n      )\n      \n      if (!textLayer) return null\n      \n      // Navigate to nodes\n      const startNode = this.getNodeFromPath(textLayer, data.startPath)\n      const endNode = this.getNodeFromPath(textLayer, data.endPath)\n      \n      if (!startNode || !endNode) return null\n      \n      const range = document.createRange()\n      range.setStart(startNode, data.startOffset)\n      range.setEnd(endNode, data.endOffset)\n      \n      return range\n    } catch (e) {\n      return null\n    }\n  }\n  \n  /**\n   * Get node from path\n   */\n  private getNodeFromPath(root: Element, path: number[]): Node | null {\n    let current: Node = root\n    \n    for (const index of path) {\n      if (!current.childNodes[index]) return null\n      current = current.childNodes[index]\n    }\n    \n    return current\n  }\n  \n  /**\n   * Add interaction handlers to highlight\n   */\n  private addHighlightInteraction(highlightId: string): void {\n    const element = document.querySelector(`[data-highlight-id=\"${highlightId}\"]`)\n    if (!element) return\n    \n    element.addEventListener('click', (e) => {\n      e.stopPropagation()\n      const highlight = this.highlights.get(highlightId)\n      if (highlight) {\n        this.emitHighlightEvent('click', highlight)\n      }\n    })\n    \n    element.addEventListener('contextmenu', (e) => {\n      e.preventDefault()\n      e.stopPropagation()\n      const highlight = this.highlights.get(highlightId)\n      if (highlight) {\n        this.emitHighlightEvent('contextmenu', highlight)\n      }\n    })\n    \n    // Add hover effects via CSS classes\n    element.addEventListener('mouseenter', () => {\n      element.classList.add('salina-highlight-hover')\n    })\n    \n    element.addEventListener('mouseleave', () => {\n      element.classList.remove('salina-highlight-hover')\n    })\n  }\n  \n  /**\n   * Remove highlight\n   */\n  removeHighlight(highlightId: string): void {\n    const highlight = this.highlights.get(highlightId)\n    if (!highlight) return\n    \n    this.highlighter.removeHighlight(highlightId)\n    this.highlights.delete(highlightId)\n    \n    this.emitHighlightEvent('remove', highlight)\n  }\n  \n  /**\n   * Update highlight color\n   */\n  updateHighlightColor(highlightId: string, color: string): void {\n    const highlight = this.highlights.get(highlightId)\n    if (!highlight) return\n    \n    const element = document.querySelector(`[data-highlight-id=\"${highlightId}\"]`) as HTMLElement\n    if (element) {\n      element.style.backgroundColor = color\n      highlight.color = color\n      this.emitHighlightEvent('update', highlight)\n    }\n  }\n  \n  /**\n   * Get all highlights\n   */\n  getHighlights(): SelectionHighlight[] {\n    return Array.from(this.highlights.values())\n  }\n  \n  /**\n   * Get highlights for a specific page\n   */\n  getPageHighlights(pageNumber: number): SelectionHighlight[] {\n    return Array.from(this.highlights.values()).filter(\n      h => h.pageNumber === pageNumber\n    )\n  }\n  \n  /**\n   * Clear all highlights\n   */\n  clearHighlights(): void {\n    this.highlights.forEach((_, id) => {\n      this.highlighter.removeHighlight(id)\n    })\n    this.highlights.clear()\n  }\n  \n  /**\n   * Emit highlight events\n   */\n  private emitHighlightEvent(\n    type: 'create' | 'click' | 'contextmenu' | 'remove' | 'update',\n    highlight: SelectionHighlight\n  ): void {\n    const event = new CustomEvent(`salina:highlight:${type}`, {\n      detail: { highlight },\n      bubbles: true\n    })\n    document.dispatchEvent(event)\n  }\n  \n  /**\n   * Export highlights for persistence\n   */\n  exportHighlights(): SelectionHighlight[] {\n    return this.getHighlights()\n  }\n  \n  /**\n   * Import highlights\n   */\n  importHighlights(highlights: SelectionHighlight[]): void {\n    this.clearHighlights()\n    this.restoreHighlights(highlights)\n  }\n  \n  destroy(): void {\n    if (this.selectionHandler) {\n      document.removeEventListener('mouseup', this.selectionHandler)\n    }\n    this.clearHighlights()\n  }\n}","import type { SalinaPDFViewerOptions, PDFPage } from '../types'\nimport type { TextContent } from '../search/SearchEngine'\n\n// PDF.js types and declarations\ninterface PDFJSLib {\n  getDocument: (src: any) => any\n  GlobalWorkerOptions: {\n    workerSrc: string\n  }\n  Util: {\n    transform: (matrix1: number[], matrix2: number[]) => number[]\n  }\n}\n\n// Global PDF.js reference\nlet pdfjsLib: PDFJSLib | null = null\n\n// Load PDF.js dynamically\nfunction loadPDFJS(): Promise<PDFJSLib> {\n  return new Promise((resolve, reject) => {\n    if (pdfjsLib) {\n      resolve(pdfjsLib)\n      return\n    }\n\n    // Check if already loaded globally\n    if (typeof window !== 'undefined' && (window as any).pdfjsLib) {\n      pdfjsLib = (window as any).pdfjsLib\n      // Setup worker if not already set\n      if (!pdfjsLib.GlobalWorkerOptions.workerSrc) {\n        pdfjsLib.GlobalWorkerOptions.workerSrc = \n          'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'\n      }\n      resolve(pdfjsLib)\n      return\n    }\n\n    // Try to load from CDN\n    const script = document.createElement('script')\n    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js'\n    script.onload = () => {\n      if ((window as any).pdfjsLib) {\n        pdfjsLib = (window as any).pdfjsLib\n        // Setup worker\n        pdfjsLib!.GlobalWorkerOptions.workerSrc = \n          'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'\n        resolve(pdfjsLib!)\n      } else {\n        reject(new Error('PDF.js failed to load'))\n      }\n    }\n    script.onerror = () => reject(new Error('Failed to load PDF.js script'))\n    document.head.appendChild(script)\n  })\n}\n\nexport class PDFRenderer {\n  private container: HTMLElement\n  private options: Required<SalinaPDFViewerOptions>\n  private pdfDocument: any = null\n  private pages: Map<number, PDFPage> = new Map()\n  private scale: number = 1.0\n  private textContent: TextContent[] = []\n\n  constructor(container: HTMLElement, options: Required<SalinaPDFViewerOptions>) {\n    this.container = container\n    this.options = options\n    this.setupPDFWorker()\n  }\n\n  async loadDocument(file: File | string | ArrayBuffer): Promise<number> {\n    try {\n      // Cancel any existing rendering\n      if (this.pdfDocument) {\n        try {\n          this.pdfDocument.destroy()\n        } catch (error) {\n          console.warn('PDFRenderer: Error destroying previous document:', error)\n        }\n      }\n      \n      // Ensure PDF.js is loaded\n      const pdfjs = await loadPDFJS()\n      \n      // Convert file to appropriate format for PDF.js\n      let data: any\n      \n      if (file instanceof File) {\n        data = await this.fileToArrayBuffer(file)\n      } else if (typeof file === 'string') {\n        // URL or base64\n        data = file\n      } else {\n        data = file\n      }\n\n      const loadingTask = pdfjs.getDocument(data)\n      this.pdfDocument = await loadingTask.promise\n      \n      // Extract text content for search\n      await this.extractTextContent()\n      \n      // Render all pages\n      await this.renderAllPages()\n      \n      return this.pdfDocument.numPages\n      \n    } catch (error) {\n      // Handle specific PDF.js errors\n      if (error.name === 'RenderingCancelledException') {\n        console.warn('PDFRenderer: Rendering was cancelled (expected during cleanup)')\n        throw new Error('PDF rendering was cancelled')\n      }\n      throw new Error(`Failed to load PDF: ${error}`)\n    }\n  }\n\n  async renderAllPages(): Promise<void> {\n    if (!this.pdfDocument) return\n\n    // Use request animation frame to prevent blocking UI\n    await new Promise(resolve => requestAnimationFrame(resolve))\n\n    const fragment = document.createDocumentFragment()\n    \n    for (let pageNum = 1; pageNum <= this.pdfDocument.numPages; pageNum++) {\n      const pageElement = await this.renderPage(pageNum)\n      fragment.appendChild(pageElement)\n      \n      // Yield control every 3 pages to prevent blocking\n      if (pageNum % 3 === 0) {\n        await new Promise(resolve => setTimeout(resolve, 0))\n      }\n    }\n    \n    // Clear container and add all pages\n    this.container.innerHTML = ''\n    this.container.appendChild(fragment)\n  }\n\n  async renderPage(pageNumber: number): Promise<HTMLElement> {\n    if (!pdfjsLib) {\n      await loadPDFJS()\n    }\n\n    const page = await this.pdfDocument.getPage(pageNumber)\n    const viewport = page.getViewport({ scale: this.scale })\n    \n    // Create page container\n    const pageContainer = document.createElement('div')\n    pageContainer.className = 'salina-pdf-page'\n    pageContainer.setAttribute('data-page-number', pageNumber.toString())\n    pageContainer.style.cssText = `\n      position: relative;\n      display: inline-block;\n      margin: 10px;\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n      background: white;\n    `\n    \n    // Create and setup canvas\n    const canvas = document.createElement('canvas')\n    const context = canvas.getContext('2d')!\n    canvas.width = viewport.width\n    canvas.height = viewport.height\n    canvas.style.display = 'block'\n    \n    pageContainer.appendChild(canvas)\n    \n    // Render PDF page with cancellation handling\n    try {\n      const renderTask = page.render({\n        canvasContext: context,\n        viewport: viewport\n      })\n      await renderTask.promise\n    } catch (error) {\n      if (error.name === 'RenderingCancelledException') {\n        console.warn(`PDFRenderer: Rendering cancelled for page ${pageNumber}`)\n        // Return empty container for cancelled renders\n        return pageContainer\n      }\n      throw error\n    }\n    \n    // Create text layer if enabled\n    let textLayer: HTMLElement | null = null\n    if (this.options.features.search || this.options.features.highlighting) {\n      textLayer = await this.createTextLayer(page, viewport, pageContainer)\n    }\n    \n    // Store page info\n    const pdfPage: PDFPage = {\n      pageNumber,\n      canvas,\n      textLayer: textLayer!,\n      scale: this.scale,\n      viewport\n    }\n    \n    this.pages.set(pageNumber, pdfPage)\n    return pageContainer\n  }\n\n  async createTextLayer(page: any, viewport: any, container: HTMLElement): Promise<HTMLElement> {\n    if (!pdfjsLib) {\n      await loadPDFJS()\n    }\n\n    const textContent = await page.getTextContent()\n    \n    const textLayer = document.createElement('div')\n    textLayer.className = 'salina-pdf-text-layer'\n    textLayer.dataset.pageNumber = container.dataset.pageNumber || '1'\n    textLayer.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: auto;\n      user-select: text;\n    `\n    \n    // Render text items\n    textContent.items.forEach((item: any) => {\n      const pdfjs = pdfjsLib!\n      const tx = pdfjs.Util.transform(\n        pdfjs.Util.transform(viewport.transform, item.transform),\n        [1, 0, 0, -1, 0, 0]\n      )\n      \n      const textElement = document.createElement('span')\n      textElement.textContent = item.str\n      textElement.style.cssText = `\n        position: absolute;\n        left: ${tx[4]}px;\n        top: ${tx[5]}px;\n        font-size: ${Math.sqrt(tx[0] * tx[0] + tx[1] * tx[1])}px;\n        font-family: sans-serif;\n        pointer-events: auto;\n        user-select: text;\n      `\n      \n      textLayer.appendChild(textElement)\n    })\n    \n    container.appendChild(textLayer)\n    return textLayer\n  }\n\n  setScale(scale: number): void {\n    this.scale = scale\n    this.updatePageScale()\n  }\n\n  private updatePageScale(): void {\n    // Optimize by only updating visible pages when possible\n    if (this.isInViewport()) {\n      this.renderVisiblePages()\n    } else {\n      this.renderAllPages()\n    }\n  }\n\n  private renderVisiblePages(): void {\n    const visiblePages = this.getVisiblePages()\n    visiblePages.forEach(pageNum => {\n      const pageElement = this.container.querySelector(`[data-page-number=\"${pageNum}\"]`) as HTMLElement\n      if (pageElement) {\n        this.updatePageElement(pageElement, pageNum)\n      }\n    })\n  }\n\n  private getVisiblePages(): number[] {\n    const containerRect = this.container.getBoundingClientRect()\n    const visiblePages: number[] = []\n    \n    this.pages.forEach((_, pageNum) => {\n      const pageElement = this.container.querySelector(`[data-page-number=\"${pageNum}\"]`) as HTMLElement\n      if (pageElement) {\n        const pageRect = pageElement.getBoundingClientRect()\n        if (pageRect.bottom >= containerRect.top && pageRect.top <= containerRect.bottom) {\n          visiblePages.push(pageNum)\n        }\n      }\n    })\n    \n    return visiblePages\n  }\n\n  private async updatePageElement(pageElement: HTMLElement, pageNumber: number): Promise<void> {\n    const page = await this.pdfDocument.getPage(pageNumber)\n    const viewport = page.getViewport({ scale: this.scale })\n    \n    const canvas = pageElement.querySelector('canvas') as HTMLCanvasElement\n    if (canvas) {\n      canvas.width = viewport.width\n      canvas.height = viewport.height\n      \n      const context = canvas.getContext('2d')!\n      const renderTask = page.render({\n        canvasContext: context,\n        viewport: viewport\n      })\n      await renderTask.promise\n    }\n  }\n\n  private isInViewport(): boolean {\n    return this.container.clientHeight > 0 && this.container.clientWidth > 0\n  }\n\n  goToPage(pageNumber: number): void {\n    const pageElement = this.container.querySelector(\n      `[data-page-number=\"${pageNumber}\"]`\n    ) as HTMLElement\n    \n    if (pageElement) {\n      pageElement.scrollIntoView({ behavior: 'smooth', block: 'start' })\n    }\n  }\n\n  calculateFitToWidthScale(): number {\n    if (!this.pdfDocument || this.pages.size === 0) return 1.0\n    \n    const firstPage = this.pages.values().next().value as PDFPage\n    const containerWidth = this.container.clientWidth - 40 // margin\n    const pageWidth = firstPage.viewport.width\n    \n    return containerWidth / pageWidth\n  }\n\n  calculateFitToHeightScale(): number {\n    if (!this.pdfDocument || this.pages.size === 0) return 1.0\n    \n    const firstPage = this.pages.values().next().value as PDFPage\n    const containerHeight = this.container.clientHeight - 40 // margin\n    const pageHeight = firstPage.viewport.height\n    \n    return containerHeight / pageHeight\n  }\n\n  getTextContent(): TextContent[] {\n    return this.textContent\n  }\n\n  handleResize(): void {\n    // Re-render if fit-to-width/height is enabled\n    if (this.options.zoom.fitToWidth) {\n      const scale = this.calculateFitToWidthScale()\n      this.setScale(scale)\n    } else if (this.options.zoom.fitToHeight) {\n      const scale = this.calculateFitToHeightScale()\n      this.setScale(scale)\n    }\n  }\n\n  destroy(): void {\n    try {\n      // Clear container first to prevent DOM conflicts\n      if (this.container) {\n        this.container.innerHTML = ''\n      }\n      \n      // Destroy PDF document\n      if (this.pdfDocument) {\n        this.pdfDocument.destroy()\n        this.pdfDocument = null\n      }\n      \n      // Clear internal data\n      this.pages.clear()\n      this.textContent = []\n    } catch (error) {\n      console.warn('PDFRenderer: Error during destruction:', error)\n    }\n  }\n\n  private async extractTextContent(): Promise<void> {\n    if (!this.pdfDocument) return\n    \n    this.textContent = []\n    \n    // Process pages in chunks to avoid blocking the main thread\n    const chunkSize = 5\n    const totalPages = this.pdfDocument.numPages\n    \n    for (let startPage = 1; startPage <= totalPages; startPage += chunkSize) {\n      const endPage = Math.min(startPage + chunkSize - 1, totalPages)\n      \n      const chunkPromises = []\n      for (let pageNum = startPage; pageNum <= endPage; pageNum++) {\n        chunkPromises.push(this.extractPageTextContent(pageNum))\n      }\n      \n      const chunkResults = await Promise.all(chunkPromises)\n      this.textContent.push(...chunkResults)\n      \n      // Yield control between chunks\n      if (endPage < totalPages) {\n        await new Promise(resolve => setTimeout(resolve, 0))\n      }\n    }\n  }\n\n  private async extractPageTextContent(pageNum: number): Promise<TextContent> {\n    if (!pdfjsLib) {\n      await loadPDFJS()\n    }\n\n    const page = await this.pdfDocument.getPage(pageNum)\n    const textContent = await page.getTextContent()\n    const viewport = page.getViewport({ scale: 1.0 })\n    \n    return {\n      pageNumber: pageNum,\n      items: textContent.items.map((item: any) => {\n        const pdfjs = pdfjsLib!\n        const tx = pdfjs.Util.transform(\n          pdfjs.Util.transform(viewport.transform, item.transform),\n          [1, 0, 0, -1, 0, 0]\n        )\n        \n        return {\n          str: item.str,\n          x: tx[4],\n          y: tx[5],\n          width: item.width,\n          height: item.height\n        }\n      })\n    }\n  }\n\n  private setupPDFWorker(): void {\n    // PDF.js worker will be setup in loadPDFJS function\n    // This ensures proper initialization order\n  }\n\n  private async fileToArrayBuffer(file: File): Promise<ArrayBuffer> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = () => resolve(reader.result as ArrayBuffer)\n      reader.onerror = () => reject(reader.error)\n      reader.readAsArrayBuffer(file)\n    })\n  }\n}","import { EventEmitter } from \"eventemitter3\";\nimport type {\n  SalinaPDFViewerOptions,\n  ViewerState,\n  SearchResult,\n  SalinaPDFPlugin,\n} from \"./types\";\nimport {\n  SimpleHighlighter,\n  type ActiveHighlight,\n} from \"./highlighting/SimpleHighlighter\";\nimport { SearchEngine } from \"./search/SearchEngine\";\nimport { TextLayerSearchEngine } from \"./search/TextLayerSearchEngine\";\nimport { SelectionHighlightEngine } from \"./highlighting/SelectionHighlightEngine\";\nimport { PDFRenderer } from \"./rendering/PDFRenderer\";\nimport { generateId } from \"./utils/helpers\";\n\nexport class SalinaPDFViewer extends EventEmitter {\n  private container: HTMLElement;\n  private options: Required<SalinaPDFViewerOptions>;\n  private state: Omit<ViewerState, \"highlights\">;\n  private pdfRenderer: PDFRenderer;\n  private simpleHighlighter: SimpleHighlighter;\n  private searchEngine: SearchEngine;\n  private textLayerSearchEngine: TextLayerSearchEngine;\n  private selectionHighlightEngine: SelectionHighlightEngine;\n  private plugins: Map<string, SalinaPDFPlugin> = new Map();\n  private resizeObserver?: ResizeObserver;\n\n  constructor(options: SalinaPDFViewerOptions) {\n    super();\n\n    this.container = options.container;\n    this.options = this.mergeOptions(options);\n    this.state = this.initializeState();\n\n    // Initialize engines\n    this.pdfRenderer = new PDFRenderer(this.container, this.options);\n    this.simpleHighlighter = new SimpleHighlighter({\n      highlightColor:\n        this.options.highlighting.defaultColor || \"rgba(255, 255, 0, 0.3)\",\n      copyHintEnabled: true,\n    });\n    this.searchEngine = new SearchEngine({\n      highlightColor:\n        this.options.search.highlightColor || \"rgba(255, 165, 0, 0.6)\",\n      caseSensitive: this.options.search.caseSensitive || false,\n      wholeWords: this.options.search.wholeWords || false,\n    });\n    \n    // Initialize new PDF.js-style engines\n    this.textLayerSearchEngine = new TextLayerSearchEngine({\n      caseSensitive: this.options.search.caseSensitive || false,\n      wholeWords: this.options.search.wholeWords || false,\n      highlightAll: true,\n    });\n    \n    this.selectionHighlightEngine = new SelectionHighlightEngine({\n      defaultColor: this.options.highlighting.defaultColor || \"yellow\",\n      allowMultipleColors: true,\n      persistHighlights: true,\n      autoHighlight: this.options.highlighting.enableManualHighlighting || false,\n    });\n\n    // Setup\n    this.setupContainer();\n    this.setupEventListeners();\n    this.setupResizeObserver();\n\n    // Load file if provided\n    if (options.file) {\n      this.loadDocument(options.file);\n    }\n  }\n\n  async loadDocument(file: File | string | ArrayBuffer): Promise<void> {\n    try {\n      this.setState({ isLoading: true, error: null });\n\n      const totalPages = await this.pdfRenderer.loadDocument(file);\n\n      this.setState({\n        totalPages,\n        currentPage: 1,\n        isLoading: false,\n      });\n\n      this.emit(\"document:loaded\", totalPages);\n      this.options.callbacks.onLoad?.(totalPages);\n    } catch (error) {\n      const errorObj =\n        error instanceof Error ? error : new Error(String(error));\n      this.setState({ error: errorObj.message, isLoading: false });\n      this.emit(\"document:error\", errorObj);\n      this.options.callbacks.onError?.(errorObj);\n      throw errorObj;\n    }\n  }\n\n  destroy(): void {\n    this.resizeObserver?.disconnect();\n    this.pdfRenderer.destroy();\n    this.simpleHighlighter.destroy();\n    this.searchEngine.destroy();\n    this.textLayerSearchEngine.destroy();\n    this.selectionHighlightEngine.destroy();\n    this.removeAllListeners();\n    this.container.innerHTML = \"\";\n  }\n\n  // Navigation\n  goToPage(page: number): void {\n    if (page < 1 || page > this.state.totalPages) return;\n\n    this.setState({ currentPage: page });\n    this.pdfRenderer.goToPage(page);\n    this.emit(\"page:changed\", page, this.state.totalPages);\n    this.options.callbacks.onPageChange?.(page, this.state.totalPages);\n  }\n\n  nextPage(): void {\n    this.goToPage(this.state.currentPage + 1);\n  }\n\n  prevPage(): void {\n    this.goToPage(this.state.currentPage - 1);\n  }\n\n  // Zoom controls\n  zoomIn(): void {\n    const newScale = Math.min(\n      this.options.zoom.max,\n      this.state.scale + this.options.zoom.step\n    );\n    this.setZoom(newScale);\n  }\n\n  zoomOut(): void {\n    const newScale = Math.max(\n      this.options.zoom.min,\n      this.state.scale - this.options.zoom.step\n    );\n    this.setZoom(newScale);\n  }\n\n  setZoom(scale: number): void {\n    const clampedScale = Math.max(\n      this.options.zoom.min,\n      Math.min(this.options.zoom.max, scale)\n    );\n\n    if (clampedScale !== this.state.scale) {\n      this.state.scale = clampedScale;\n\n      // Update simple highlighter scale for accurate positioning\n      this.simpleHighlighter.updateScale(clampedScale);\n\n      // Update PDF renderer scale to re-render pages\n      this.pdfRenderer.setScale(clampedScale);\n\n      // Emit zoom change event\n      this.emit(\"zoom:changed\", clampedScale);\n      this.options.callbacks.onZoom?.(clampedScale);\n    }\n  }\n\n  fitToWidth(): void {\n    if (!this.container) return;\n\n    // Use PDFRenderer method to calculate and apply scale\n    const scale = this.pdfRenderer.calculateFitToWidthScale();\n    this.setZoom(scale);\n  }\n\n  fitToHeight(): void {\n    if (!this.container) return;\n\n    // Use PDFRenderer method to calculate and apply scale\n    const scale = this.pdfRenderer.calculateFitToHeightScale();\n    this.setZoom(scale);\n  }\n\n  // Search - Legacy method using coordinate-based highlighting\n  search(query: string): SearchResult[] {\n    if (!query.trim()) {\n      this.clearSearch();\n      return [];\n    }\n\n    this.setState({ searchQuery: query });\n    const results = this.searchEngine.search(\n      query,\n      this.pdfRenderer.getTextContent()\n    );\n\n    this.setState({\n      searchResults: results,\n      currentSearchIndex: results.length > 0 ? 0 : -1,\n    });\n\n    this.emit(\"search:results\", results);\n    this.options.callbacks.onSearch?.(results);\n\n    return results;\n  }\n\n  // Search using PDF.js-style text layer highlighting\n  searchInTextLayer(query: string): SearchResult[] {\n    if (!query.trim()) {\n      this.clearTextLayerSearch();\n      return [];\n    }\n    \n    this.setState({ searchQuery: query });\n    const results = this.textLayerSearchEngine.search(query);\n    \n    this.setState({\n      searchResults: results,\n      currentSearchIndex: results.length > 0 ? 0 : -1,\n    });\n    \n    this.emit(\"search:results\", results);\n    this.options.callbacks.onSearch?.(results);\n    return results;\n  }\n\n  clearSearch(): void {\n    this.setState({\n      searchQuery: \"\",\n      searchResults: [],\n      currentSearchIndex: -1,\n    });\n\n    this.searchEngine.clearResults();\n    this.emit(\"search:cleared\");\n  }\n\n  clearTextLayerSearch(): void {\n    this.setState({\n      searchQuery: \"\",\n      searchResults: [],\n      currentSearchIndex: -1,\n    });\n\n    this.textLayerSearchEngine.clear();\n    this.emit(\"search:cleared\");\n  }\n\n  nextSearchResult(): void {\n    if (this.state.searchResults.length === 0) return;\n\n    const nextIndex =\n      (this.state.currentSearchIndex + 1) % this.state.searchResults.length;\n    this.setState({ currentSearchIndex: nextIndex });\n\n    const result = this.state.searchResults[nextIndex];\n    this.goToPage(result.pageNumber);\n  }\n\n  prevSearchResult(): void {\n    if (this.state.searchResults.length === 0) return;\n\n    const prevIndex =\n      this.state.currentSearchIndex === 0\n        ? this.state.searchResults.length - 1\n        : this.state.currentSearchIndex - 1;\n\n    this.setState({ currentSearchIndex: prevIndex });\n\n    const result = this.state.searchResults[prevIndex];\n    this.goToPage(result.pageNumber);\n  }\n\n  // Text layer search navigation\n  nextTextLayerSearchResult(): void {\n    this.textLayerSearchEngine.nextMatch();\n  }\n\n  prevTextLayerSearchResult(): void {\n    this.textLayerSearchEngine.previousMatch();\n  }\n\n  getCurrentSearchMatch(): { index: number; total: number } | null {\n    return this.textLayerSearchEngine.getCurrentMatch();\n  }\n\n  // Simple highlighting methods\n  getActiveHighlight(): ActiveHighlight | null {\n    return this.simpleHighlighter.getActiveHighlight();\n  }\n\n  clearHighlights(): void {\n    this.simpleHighlighter.clearHighlights();\n    this.selectionHighlightEngine.clearHighlights();\n    this.emit(\"highlight:cleared\");\n  }\n\n  // Manual highlighting methods using browser selection\n  createHighlightFromSelection(color?: string): boolean {\n    const highlight = this.selectionHighlightEngine.createHighlightFromCurrentSelection(color);\n    if (highlight) {\n      this.emit(\"highlight:created\", highlight);\n      return true;\n    }\n    return false;\n  }\n\n  removeHighlight(highlightId: string): void {\n    this.selectionHighlightEngine.removeHighlight(highlightId);\n    this.emit(\"highlight:removed\", highlightId);\n  }\n\n  updateHighlightColor(highlightId: string, color: string): void {\n    this.selectionHighlightEngine.updateHighlightColor(highlightId, color);\n    this.emit(\"highlight:updated\", highlightId, color);\n  }\n\n  getHighlights() {\n    return this.selectionHighlightEngine.getHighlights();\n  }\n\n  getPageHighlights(pageNumber: number) {\n    return this.selectionHighlightEngine.getPageHighlights(pageNumber);\n  }\n\n  exportHighlights() {\n    return this.selectionHighlightEngine.exportHighlights();\n  }\n\n  importHighlights(highlights: any[]) {\n    this.selectionHighlightEngine.importHighlights(highlights);\n    this.emit(\"highlights:imported\", highlights.length);\n  }\n\n  // Legacy API methods for compatibility (simplified)\n  addSimpleHighlight(): void {\n    // Note: Simple highlighter doesn't support programmatic highlight addition\n    // This is for compatibility only\n    console.warn(\n      \"addSimpleHighlight: Simple highlighter only supports mouse-based highlighting\"\n    );\n  }\n\n  removeSimpleHighlight(): boolean {\n    // Note: Simple highlighter doesn't support individual highlight removal\n    // This clears all highlights for compatibility\n    this.clearHighlights();\n    return true;\n  }\n\n  getSimpleHighlights(): ActiveHighlight[] {\n    const active = this.getActiveHighlight();\n    return active ? [active] : [];\n  }\n\n  exportSimpleHighlights(): string {\n    const active = this.getActiveHighlight();\n    return JSON.stringify(active ? [active] : [], null, 2);\n  }\n\n  importSimpleHighlights(): void {\n    // Note: Simple highlighter doesn't support highlight importing\n    console.warn(\n      \"importSimpleHighlights: Simple highlighter doesn't support highlight importing\"\n    );\n  }\n\n  // Plugin System\n  use(plugin: SalinaPDFPlugin): void {\n    if (this.plugins.has(plugin.name)) {\n      throw new Error(`Plugin '${plugin.name}' is already installed`);\n    }\n\n    plugin.install(this);\n    this.plugins.set(plugin.name, plugin);\n  }\n\n  unuse(pluginName: string): void {\n    const plugin = this.plugins.get(pluginName);\n    if (plugin) {\n      plugin.uninstall(this);\n      this.plugins.delete(pluginName);\n    }\n  }\n\n  // Getters\n  getCurrentPage(): number {\n    return this.state.currentPage;\n  }\n\n  getTotalPages(): number {\n    return this.state.totalPages;\n  }\n\n  getScale(): number {\n    return this.state.scale;\n  }\n\n  getSearchResults(): SearchResult[] {\n    return this.state.searchResults;\n  }\n\n  getCurrentSearchIndex(): number {\n    return this.state.currentSearchIndex;\n  }\n\n  isLoading(): boolean {\n    return this.state.isLoading;\n  }\n\n  getError(): string | null {\n    return this.state.error;\n  }\n\n  // Private Methods\n\n  private mergeOptions(\n    options: SalinaPDFViewerOptions\n  ): Required<SalinaPDFViewerOptions> {\n    return {\n      container: options.container,\n      file: options.file ?? undefined,\n      theme: options.theme ?? \"light\",\n      width: options.width ?? \"100%\",\n      height: options.height ?? \"100%\",\n      features: {\n        highlighting: true,\n        search: true,\n        navigation: true,\n        zoom: true,\n        fullscreen: false,\n        print: false,\n        download: false,\n        export: true,\n        annotations: false,\n        ...options.features,\n      },\n      highlighting: {\n        defaultColor: \"rgba(255, 255, 0, 0.3)\",\n        allowMultipleColors: false, // Simple highlighter uses single color\n        persistHighlights: false, // Simple highlighter is non-persistent\n        ...options.highlighting,\n      },\n      search: {\n        highlightColor: \"rgba(255, 165, 0, 0.6)\",\n        caseSensitive: false,\n        wholeWords: false,\n        ...options.search,\n      },\n      zoom: {\n        min: options.zoom?.min ?? 0.5,\n        max: options.zoom?.max ?? 3.0,\n        step: options.zoom?.step ?? 0.2,\n        default: options.zoom?.default ?? 1.0,\n        fitToWidth: options.zoom?.fitToWidth ?? true,\n        fitToHeight: options.zoom?.fitToHeight ?? true,\n        ...options.zoom,\n      },\n      callbacks: {\n        onLoad: () => {},\n        onPageChange: () => {},\n        onSearch: () => {},\n        onHighlight: () => {},\n        onHighlightRemove: () => {},\n        onError: () => {},\n        onZoom: () => {},\n        ...options.callbacks,\n      },\n    };\n  }\n\n  private initializeState(): Omit<ViewerState, \"highlights\"> {\n    return {\n      currentPage: 1,\n      totalPages: 0,\n      scale: this.options.zoom.default,\n      isLoading: false,\n      error: null,\n      searchQuery: \"\",\n      searchResults: [],\n      currentSearchIndex: -1,\n    };\n  }\n\n  private setState(updates: Partial<Omit<ViewerState, \"highlights\">>): void {\n    Object.assign(this.state, updates);\n  }\n\n  private setupContainer(): void {\n    this.container.classList.add(\"salina-pdf-viewer\");\n    this.container.setAttribute(\"data-theme\", this.options.theme);\n\n    // Set container dimensions\n    if (typeof this.options.width === \"number\") {\n      this.container.style.width = `${this.options.width}px`;\n    } else {\n      this.container.style.width = this.options.width;\n    }\n\n    if (typeof this.options.height === \"number\") {\n      this.container.style.height = `${this.options.height}px`;\n    } else {\n      this.container.style.height = this.options.height;\n    }\n  }\n\n  private setupEventListeners(): void {\n    // Keyboard shortcuts\n    document.addEventListener(\"keydown\", (e) => {\n      if (e.ctrlKey || e.metaKey) {\n        switch (e.key) {\n          case \"f\":\n          case \"F\":\n            if (this.options.features.search) {\n              e.preventDefault();\n              // Emit search focus event\n              this.emit(\"search:focus\");\n            }\n            break;\n          case \"+\":\n          case \"=\":\n            e.preventDefault();\n            this.zoomIn();\n            break;\n          case \"-\":\n            e.preventDefault();\n            this.zoomOut();\n            break;\n          case \"0\":\n            e.preventDefault();\n            this.setZoom(1.0);\n            break;\n        }\n      }\n    });\n\n    // Handle viewport changes for highlight accuracy\n    let scrollTimeout: number;\n    const handleScroll = () => {\n      clearTimeout(scrollTimeout);\n      scrollTimeout = window.setTimeout(() => {\n        // Simple highlighter handles its own viewport updates\n      }, 100);\n    };\n\n    // Listen for scroll events on the container and window\n    this.container.addEventListener(\"scroll\", handleScroll);\n    window.addEventListener(\"scroll\", handleScroll);\n\n    // Handle resize events\n    window.addEventListener(\"resize\", () => {\n      this.pdfRenderer.handleResize();\n    });\n  }\n\n  private setupResizeObserver(): void {\n    if (typeof ResizeObserver !== \"undefined\") {\n      this.resizeObserver = new ResizeObserver(() => {\n        this.pdfRenderer.handleResize();\n      });\n      this.resizeObserver.observe(this.container);\n    }\n  }\n}\n","import type { Highlight } from '../types'\n\nexport interface HighlightOptions {\n  defaultColor: string\n  allowMultipleColors: boolean\n  persistHighlights: boolean\n}\n\ninterface PositionInfo {\n  pageContainer: HTMLElement\n  textLayer: HTMLElement | null\n  containerRect: DOMRect\n  textLayerRect: DOMRect | null\n  scrollOffset: { x: number; y: number }\n}\n\nexport class HighlightEngine {\n  private highlights: Map<string, Highlight> = new Map()\n  private highlightElements: Map<string, HTMLElement> = new Map()\n  private scale: number = 1.0\n  private options: HighlightOptions\n\n  constructor(options: HighlightOptions) {\n    this.options = options\n    console.log('HighlightEngine initialized with options:', options)\n  }\n\n  addHighlight(highlight: Highlight): void {\n    this.highlights.set(highlight.id, highlight)\n    this.renderHighlight(highlight)\n  }\n\n  removeHighlight(id: string): void {\n    this.highlights.delete(id)\n    const element = this.highlightElements.get(id)\n    if (element) {\n      element.remove()\n      this.highlightElements.delete(id)\n    }\n  }\n\n  clearHighlights(): void {\n    this.highlights.clear()\n    this.highlightElements.forEach(element => element.remove())\n    this.highlightElements.clear()\n  }\n\n  updateScale(scale: number): void {\n    this.scale = scale\n    // Re-render all highlights with new scale\n    this.highlights.forEach(highlight => this.renderHighlight(highlight))\n  }\n\n  getHighlights(): Highlight[] {\n    return Array.from(this.highlights.values())\n  }\n\n  getHighlightById(id: string): Highlight | undefined {\n    return this.highlights.get(id)\n  }\n\n  destroy(): void {\n    this.clearHighlights()\n  }\n\n  /**\n   * Handle viewport changes (scroll, resize) to maintain highlight accuracy\n   */\n  public handleViewportChange(): void {\n    // Re-render all highlights to account for viewport changes\n    this.highlights.forEach(highlight => this.renderHighlight(highlight))\n  }\n\n  /**\n   * Optimize highlight rendering by only updating visible highlights\n   */\n  public updateVisibleHighlights(): void {\n    const viewportRect = {\n      top: window.scrollY,\n      bottom: window.scrollY + window.innerHeight,\n      left: window.scrollX,\n      right: window.scrollX + window.innerWidth\n    }\n\n    this.highlights.forEach((highlight, id) => {\n      const element = this.highlightElements.get(id)\n      if (element) {\n        const elementRect = element.getBoundingClientRect()\n        const isVisible = !(\n          elementRect.bottom < viewportRect.top ||\n          elementRect.top > viewportRect.bottom ||\n          elementRect.right < viewportRect.left ||\n          elementRect.left > viewportRect.right\n        )\n\n        // Only re-render visible highlights for performance\n        if (isVisible) {\n          this.renderHighlight(highlight)\n        }\n      }\n    })\n  }\n\n  /**\n   * Get comprehensive positioning information for a page\n   */\n  private getPositionInfo(pageNumber: number): PositionInfo | null {\n    const pageContainer = document.querySelector(\n      `[data-page-number=\"${pageNumber}\"]`\n    ) as HTMLElement\n    \n    if (!pageContainer) return null\n\n    // Try multiple selectors for text layer (different PDF libraries use different classes)\n    const textLayer = pageContainer.querySelector('.textLayer') as HTMLElement ||\n                     pageContainer.querySelector('.react-pdf__Page__textContent') as HTMLElement ||\n                     pageContainer.querySelector('.salina-pdf-text-layer') as HTMLElement\n\n    const containerRect = pageContainer.getBoundingClientRect()\n    const textLayerRect = textLayer?.getBoundingClientRect() || null\n\n    // Get scroll offset from the PDF viewer container\n    const viewerContainer = pageContainer.closest('.salina-pdf-viewer, .pdf-container, .pdf-viewer') as HTMLElement\n    const scrollOffset = {\n      x: viewerContainer?.scrollLeft || 0,\n      y: viewerContainer?.scrollTop || 0\n    }\n\n    return {\n      pageContainer,\n      textLayer,\n      containerRect,\n      textLayerRect,\n      scrollOffset\n    }\n  }\n\n  /**\n   * Calculate accurate highlight position with proper coordinate transformation\n   */\n  private renderHighlight(highlight: Highlight): void {\n    // Remove existing element if it exists\n    const existingElement = this.highlightElements.get(highlight.id)\n    if (existingElement) {\n      existingElement.remove()\n    }\n\n    const positionInfo = this.getPositionInfo(highlight.pageNumber)\n    if (!positionInfo) return\n\n    const { pageContainer, textLayer, containerRect, textLayerRect, scrollOffset } = positionInfo\n\n    // Create highlight element\n    const highlightElement = document.createElement('div')\n    highlightElement.className = 'salina-highlight'\n    highlightElement.setAttribute('data-highlight-id', highlight.id)\n    highlightElement.title = highlight.text\n    \n    // Calculate positioning with proper coordinate system and viewport compensation\n    // Highlights should be positioned relative to the page container\n    // The stored coordinates are already normalized to the page coordinate system\n    const scaledPosition = {\n      x: highlight.position.x * this.scale,\n      y: highlight.position.y * this.scale,\n      width: highlight.position.width * this.scale,\n      height: highlight.position.height * this.scale\n    }\n\n    // Apply styles with accurate positioning\n    Object.assign(highlightElement.style, {\n      position: 'absolute',\n      left: `${scaledPosition.x}px`,\n      top: `${scaledPosition.y}px`,\n      width: `${scaledPosition.width}px`,\n      height: `${scaledPosition.height}px`,\n      backgroundColor: highlight.color,\n      pointerEvents: 'auto',\n      borderRadius: '2px',\n      zIndex: '10',\n      mixBlendMode: 'multiply',\n      opacity: '0.4',\n      transition: 'opacity 0.2s ease, transform 0.2s ease',\n      cursor: 'pointer',\n      // Add a subtle outline to improve visibility\n      outline: '1px solid transparent',\n      boxSizing: 'border-box'\n    })\n\n    // Enhanced interaction handlers\n    highlightElement.addEventListener('click', (e) => {\n      e.stopPropagation()\n      this.handleHighlightClick(highlight)\n    })\n\n    highlightElement.addEventListener('mouseenter', () => {\n      highlightElement.style.opacity = '0.6'\n      highlightElement.style.transform = 'scale(1.01)'\n      highlightElement.style.outline = '1px solid rgba(0, 123, 255, 0.3)'\n    })\n\n    highlightElement.addEventListener('mouseleave', () => {\n      highlightElement.style.opacity = '0.4'\n      highlightElement.style.transform = 'scale(1)'\n      highlightElement.style.outline = '1px solid transparent'\n    })\n\n    // Add to page container\n    pageContainer.appendChild(highlightElement)\n    this.highlightElements.set(highlight.id, highlightElement)\n  }\n\n  /**\n   * Create highlight from text selection with accurate coordinate calculation\n   */\n  public createHighlightFromSelection(\n    selection: Selection,\n    pageNumber: number,\n    color: string = this.options.defaultColor\n  ): Highlight[] | null {\n    if (!selection.rangeCount) return null\n\n    const range = selection.getRangeAt(0)\n    const text = selection.toString().trim()\n    if (!text) return null\n\n    const positionInfo = this.getPositionInfo(pageNumber)\n    if (!positionInfo) return null\n\n    const { pageContainer, containerRect } = positionInfo\n    const rects = range.getClientRects()\n    const highlights: Highlight[] = []\n\n    Array.from(rects).forEach((rect, index) => {\n      if (rect.width > 0 && rect.height > 0) {\n        // Calculate coordinates relative to the page container\n        const relativeX = rect.left - containerRect.left\n        const relativeY = rect.top - containerRect.top\n\n        // Store coordinates normalized by scale (so they remain consistent across zoom levels)\n        const normalizedPosition = {\n          x: relativeX / this.scale,\n          y: relativeY / this.scale,\n          width: rect.width / this.scale,\n          height: rect.height / this.scale\n        }\n\n        const highlight: Highlight = {\n          id: this.generateHighlightId(),\n          text,\n          color,\n          position: normalizedPosition,\n          pageNumber,\n          timestamp: Date.now()\n        }\n\n        highlights.push(highlight)\n        this.addHighlight(highlight)\n      }\n    })\n\n    return highlights.length > 0 ? highlights : null\n  }\n\n  private generateHighlightId(): string {\n    return `highlight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n  }\n\n  private handleHighlightClick(highlight: Highlight): void {\n    // Emit custom event for highlight interaction\n    const event = new CustomEvent('salina:highlight:click', {\n      detail: { highlight },\n      bubbles: true\n    })\n    document.dispatchEvent(event)\n  }\n}","/**\n * Generate a unique ID for highlights and other entities\n */\nexport function generateId(): string {\n  return Math.random().toString(36).substr(2, 9) + Date.now().toString(36)\n}\n\n/**\n * Debounce function calls\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: any\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout)\n    timeout = setTimeout(() => func(...args), wait)\n  }\n}\n\n/**\n * Throttle function calls\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  limit: number\n): (...args: Parameters<T>) => void {\n  let inThrottle: boolean\n  return (...args: Parameters<T>) => {\n    if (!inThrottle) {\n      func(...args)\n      inThrottle = true\n      setTimeout(() => inThrottle = false, limit)\n    }\n  }\n}\n\n/**\n * Clamp a number between min and max values\n */\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max)\n}\n\n/**\n * Check if an element is in viewport\n */\nexport function isInViewport(element: HTMLElement): boolean {\n  const rect = element.getBoundingClientRect()\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  )\n}\n\n/**\n * Get the bounding rect of a text range\n */\nexport function getRangeRect(range: Range): DOMRect {\n  const rects = range.getClientRects()\n  if (rects.length === 0) {\n    throw new Error('Range has no client rects')\n  }\n  \n  // Get the combined bounding rect\n  let left = Infinity\n  let top = Infinity\n  let right = -Infinity\n  let bottom = -Infinity\n  \n  for (let i = 0; i < rects.length; i++) {\n    const rect = rects[i]\n    left = Math.min(left, rect.left)\n    top = Math.min(top, rect.top)\n    right = Math.max(right, rect.right)\n    bottom = Math.max(bottom, rect.bottom)\n  }\n  \n  return new DOMRect(left, top, right - left, bottom - top)\n}\n\n/**\n * Download a blob as a file\n */\nexport function downloadBlob(blob: Blob, filename: string): void {\n  const url = URL.createObjectURL(blob)\n  const link = document.createElement('a')\n  link.href = url\n  link.download = filename\n  document.body.appendChild(link)\n  link.click()\n  document.body.removeChild(link)\n  URL.revokeObjectURL(url)\n}\n\n/**\n * Convert data to blob and download\n */\nexport function downloadData(data: string, filename: string, mimeType: string = 'application/json'): void {\n  const blob = new Blob([data], { type: mimeType })\n  downloadBlob(blob, filename)\n}\n\n/**\n * Load a file and return its content as text\n */\nexport function loadFile(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(reader.result as string)\n    reader.onerror = () => reject(reader.error)\n    reader.readAsText(file)\n  })\n}\n\n/**\n * Deep merge two objects\n */\nexport function deepMerge<T extends Record<string, any>>(target: T, source: Partial<T>): T {\n  const result = { ...target }\n  \n  for (const key in source) {\n    if (source.hasOwnProperty(key)) {\n      const sourceValue = source[key]\n      const targetValue = result[key]\n      \n      if (\n        sourceValue && \n        typeof sourceValue === 'object' && \n        !Array.isArray(sourceValue) &&\n        targetValue &&\n        typeof targetValue === 'object' &&\n        !Array.isArray(targetValue)\n      ) {\n        result[key] = deepMerge(targetValue, sourceValue)\n      } else {\n        result[key] = sourceValue as any\n      }\n    }\n  }\n  \n  return result\n}\n\n/**\n * Check if code is running in browser environment\n */\nexport function isBrowser(): boolean {\n  return typeof window !== 'undefined' && typeof document !== 'undefined'\n}\n\n/**\n * Check if touch events are supported\n */\nexport function isTouchDevice(): boolean {\n  return isBrowser() && ('ontouchstart' in window || navigator.maxTouchPoints > 0)\n}\n\n/**\n * Format file size in human readable format\n */\nexport function formatFileSize(bytes: number): string {\n  const units = ['B', 'KB', 'MB', 'GB']\n  let size = bytes\n  let unitIndex = 0\n  \n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024\n    unitIndex++\n  }\n  \n  return `${size.toFixed(1)} ${units[unitIndex]}`\n}\n\n/**\n * Create a promise that resolves after a delay\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\n/**\n * Retry a function with exponential backoff\n */\nexport async function retry<T>(\n  fn: () => Promise<T>,\n  maxAttempts: number = 3,\n  baseDelay: number = 1000\n): Promise<T> {\n  let lastError: Error\n  \n  for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n    try {\n      return await fn()\n    } catch (error) {\n      lastError = error as Error\n      if (attempt === maxAttempts) break\n      \n      const delayTime = baseDelay * Math.pow(2, attempt - 1)\n      await delay(delayTime)\n    }\n  }\n  \n  throw lastError!\n}","// Performance utilities for the PDF viewer\nexport class PerformanceOptimizer {\n  private static rafId: number | null = null\n  private static taskQueue: (() => void)[] = []\n  \n  /**\n   * Debounce function calls to improve performance\n   */\n  static debounce<T extends (...args: any[]) => any>(\n    func: T,\n    wait: number\n  ): (...args: Parameters<T>) => void {\n    let timeout: any\n    \n    return (...args: Parameters<T>) => {\n      clearTimeout(timeout)\n      timeout = setTimeout(() => func(...args), wait)\n    }\n  }\n  \n  /**\n   * Throttle function calls to limit execution frequency\n   */\n  static throttle<T extends (...args: any[]) => any>(\n    func: T,\n    limit: number\n  ): (...args: Parameters<T>) => void {\n    let inThrottle: boolean\n    \n    return (...args: Parameters<T>) => {\n      if (!inThrottle) {\n        func(...args)\n        inThrottle = true\n        setTimeout(() => inThrottle = false, limit)\n      }\n    }\n  }\n  \n  /**\n   * Queue tasks to be executed on next animation frame\n   */\n  static queueTask(task: () => void): void {\n    this.taskQueue.push(task)\n    \n    if (this.rafId === null) {\n      this.rafId = requestAnimationFrame(() => {\n        this.processTasks()\n        this.rafId = null\n      })\n    }\n  }\n  \n  private static processTasks(): void {\n    const tasks = this.taskQueue.splice(0)\n    tasks.forEach(task => {\n      try {\n        task()\n      } catch (error) {\n        console.error('Task execution error:', error)\n      }\n    })\n  }\n  \n  /**\n   * Create a cancellable timeout\n   */\n  static createCancellableTimeout(\n    callback: () => void,\n    delay: number\n  ): { cancel: () => void } {\n    const timeoutId = setTimeout(callback, delay)\n    \n    return {\n      cancel: () => clearTimeout(timeoutId)\n    }\n  }\n  \n  /**\n   * Measure and log performance metrics\n   */\n  static measurePerformance<T>(\n    name: string,\n    fn: () => T\n  ): T {\n    const start = performance.now()\n    const result = fn()\n    const end = performance.now()\n    \n    console.log(`${name} took ${end - start} milliseconds`)\n    return result\n  }\n  \n  /**\n   * Create a performance observer for monitoring\n   */\n  static createPerformanceObserver(\n    callback: (entries: PerformanceEntry[]) => void\n  ): PerformanceObserver | null {\n    if (typeof PerformanceObserver === 'undefined') {\n      return null\n    }\n    \n    const observer = new PerformanceObserver((list) => {\n      callback(list.getEntries())\n    })\n    \n    try {\n      observer.observe({ entryTypes: ['measure', 'navigation', 'paint'] } as any)\n      return observer\n    } catch (error) {\n      console.warn('Performance observer not supported:', error)\n      return null\n    }\n  }\n}\n\n/**\n * Memory management utilities\n */\nexport class MemoryManager {\n  private static cache = new Map<string, any>()\n  private static maxCacheSize = 50\n  \n  /**\n   * Store item in cache with automatic cleanup\n   */\n  static setCache(key: string, value: any): void {\n    if (this.cache.size >= this.maxCacheSize) {\n      const firstKey = this.cache.keys().next().value\n      this.cache.delete(firstKey)\n    }\n    \n    this.cache.set(key, value)\n  }\n  \n  /**\n   * Get item from cache\n   */\n  static getCache(key: string): any {\n    return this.cache.get(key) || null\n  }\n  \n  /**\n   * Clear cache\n   */\n  static clearCache(): void {\n    this.cache.clear()\n  }\n  \n  /**\n   * Get current memory usage (if available)\n   */\n  static getMemoryUsage(): any {\n    if ('memory' in performance) {\n      return (performance as any).memory\n    }\n    return null\n  }\n  \n  /**\n   * Force garbage collection (development only)\n   */\n  static forceGC(): void {\n    if ('gc' in window && typeof (window as any).gc === 'function') {\n      (window as any).gc()\n    }\n  }\n}\n\n/**\n * Virtual scrolling utilities for large PDF documents\n */\nexport class VirtualScrolling {\n  private container: HTMLElement\n  private itemHeight: number\n  private visibleRange: { start: number; end: number } = { start: 0, end: 0 }\n  private totalItems: number = 0\n  \n  constructor(container: HTMLElement, itemHeight: number) {\n    this.container = container\n    this.itemHeight = itemHeight\n    console.log('VirtualScrolling initialized for container:', container.tagName)\n  }\n  \n  /**\n   * Calculate visible range based on scroll position\n   */\n  calculateVisibleRange(scrollTop: number, containerHeight: number): { start: number; end: number } {\n    const start = Math.floor(scrollTop / this.itemHeight)\n    const visibleCount = Math.ceil(containerHeight / this.itemHeight)\n    const end = Math.min(start + visibleCount + 1, this.totalItems - 1)\n    \n    this.visibleRange = { start: Math.max(0, start - 1), end }\n    return this.visibleRange\n  }\n  \n  /**\n   * Get current visible range\n   */\n  getVisibleRange(): { start: number; end: number } {\n    return this.visibleRange\n  }\n  \n  /**\n   * Set total number of items\n   */\n  setTotalItems(count: number): void {\n    this.totalItems = count\n  }\n  \n  /**\n   * Get total height of all items\n   */\n  getTotalHeight(): number {\n    return this.totalItems * this.itemHeight\n  }\n}"],"mappings":"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","names":["require_eventemitter3","__commonJSMin","exports","module","has","prefix","Events","EE","fn","context","once","addListener","emitter","event","listener","evt","clearEvent","EventEmitter","names","events","name","handlers","i","l","ee","listeners","a1","a2","a3","a4","a5","len","args","length","j","index_exports","__export","HighlightEngine","MemoryManager","PDFRenderer","PerformanceOptimizer","SalinaPDFViewer","SearchEngine","SelectionHighlightEngine","SimpleHighlighter","TextLayerHighlighter","TextLayerSearchEngine","VERSION","VirtualScrolling","clamp","debounce","deepMerge","delay","downloadBlob","downloadData","formatFileSize","generateId","getRangeRect","isBrowser","isInViewport","isTouchDevice","loadFile","retry","throttle","import_index","SimpleHighlighter","options","scale","selection","selectedText","range","pageNumber","pageContainer","textLayer","startContainer","endContainer","commonAncestor","rectangles","e","target","element","el","pageAttr","pageRect","rects","rect","relativeX","relativeY","highlight","index","highlightElement","firstRect","copyHint","bubble","__async","err","DANGEROUS_REGEX_PATTERNS","validateSearchQuery","query","testPattern","pattern","createSafeRegex","searchQuery","escapedQuery","error","SearchEngine","options","textContent","results","globalIndex","regex","pageContent","item","text","index","length","matches","match","iterationCount","maxIterations","resultsByPage","result","__spreadProps","__spreadValues","pageResults","pageNumber","pageContainer","fragment","highlightElement","element","start","end","context","string","el","TextLayerHighlighter","textLayer","query","caseSensitive","textDivs","matches","pageText","div","searchQuery","searchText","matchIndex","searchIndex","matchEnd","charCount","beginDiv","beginOffset","endDiv","endOffset","divIdx","divLength","matchDivs","highlightAll","pageMatches","match","pageMatchList","pageIndex","a","b","index","isSelected","begin","end","i","element","start","text","textNode","highlightSpan","highlightedNode","highlightedText","highlight","parent","allMatches","el","selection","range","rects","color","id","selectionInfo","highlightId","e","contents","TextLayerSearchEngine","options","TextLayerHighlighter","__spreadValues","query","results","textLayer","pageNumber","matches","match","index","bounds","searchQuery","textDivs","begin","end","startText","charBefore","endText","charAfter","rects","div","rect","r","right","bottom","pageContainer","pageRect","contextLength","fullText","matchText","matchStart","contextStart","contextEnd","context","SelectionHighlightEngine","options","TextLayerHighlighter","__spreadValues","event","selection","color","_a","selectionInfo","range","container","textLayer","pageNumber","highlightId","highlight","rects","pageRect","minX","r","minY","maxX","maxY","startContainer","endContainer","startPath","endPath","node","path","current","parent","index","highlights","e","serialized","data","startNode","endNode","root","element","h","_","id","type","pdfjsLib","loadPDFJS","resolve","reject","script","PDFRenderer","container","options","file","__async","error","pdfjs","data","loadingTask","fragment","pageNum","pageElement","pageNumber","page","viewport","pageContainer","canvas","context","textLayer","pdfPage","textContent","item","tx","textElement","scale","containerRect","visiblePages","_","pageRect","firstPage","containerWidth","pageWidth","containerHeight","pageHeight","chunkSize","totalPages","startPage","endPage","chunkPromises","chunkResults","reader","SalinaPDFViewer","EventEmitter","options","PDFRenderer","SimpleHighlighter","SearchEngine","TextLayerSearchEngine","SelectionHighlightEngine","file","__async","_a","_b","_c","_d","totalPages","error","errorObj","page","newScale","scale","clampedScale","query","results","nextIndex","result","prevIndex","color","highlight","highlightId","pageNumber","highlights","active","plugin","pluginName","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","__spreadValues","updates","e","scrollTimeout","handleScroll","HighlightEngine","options","highlight","id","element","scale","viewportRect","elementRect","pageNumber","pageContainer","textLayer","containerRect","textLayerRect","viewerContainer","scrollOffset","existingElement","positionInfo","highlightElement","scaledPosition","e","selection","color","range","text","rects","highlights","rect","index","relativeX","relativeY","normalizedPosition","event","generateId","debounce","func","wait","timeout","args","throttle","limit","inThrottle","clamp","value","min","max","isInViewport","element","rect","getRangeRect","range","rects","left","top","right","bottom","i","downloadBlob","blob","filename","url","link","downloadData","data","mimeType","loadFile","file","resolve","reject","reader","deepMerge","target","source","result","__spreadValues","key","sourceValue","targetValue","isBrowser","isTouchDevice","formatFileSize","bytes","units","size","unitIndex","delay","ms","retry","fn","maxAttempts","baseDelay","__async","lastError","attempt","error","delayTime","PerformanceOptimizer","func","wait","timeout","args","limit","inThrottle","task","error","callback","delay","timeoutId","name","fn","start","result","end","observer","list","MemoryManager","key","value","firstKey","VirtualScrolling","container","itemHeight","scrollTop","containerHeight","visibleCount","count","VERSION"]}