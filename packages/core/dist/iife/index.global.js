var SalinaPDFViewer=(()=>{var J=Object.create;var I=Object.defineProperty,ee=Object.defineProperties,te=Object.getOwnPropertyDescriptor,ie=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,re=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var W=(h,t,e)=>t in h?I(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e,d=(h,t)=>{for(var e in t||(t={}))j.call(t,e)&&W(h,e,t[e]);if(V)for(var e of V(t))se.call(t,e)&&W(h,e,t[e]);return h},q=(h,t)=>ee(h,ie(t));var oe=(h,t)=>()=>(t||h((t={exports:{}}).exports,t),t.exports),ae=(h,t)=>{for(var e in t)I(h,e,{get:t[e],enumerable:!0})},Q=(h,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ne(t))!j.call(h,n)&&n!==e&&I(h,n,{get:()=>t[n],enumerable:!(i=te(t,n))||i.enumerable});return h};var he=(h,t,e)=>(e=h!=null?J(re(h)):{},Q(t||!h||!h.__esModule?I(e,"default",{value:h,enumerable:!0}):e,h)),le=h=>Q(I({},"__esModule",{value:!0}),h);var f=(h,t,e)=>new Promise((i,n)=>{var r=a=>{try{o(e.next(a))}catch(l){n(l)}},s=a=>{try{o(e.throw(a))}catch(l){n(l)}},o=a=>a.done?i(a.value):Promise.resolve(a.value).then(r,s);o((e=e.apply(h,t)).next())});var G=oe((Le,_)=>{"use strict";var ce=Object.prototype.hasOwnProperty,v="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(v=!1));function ge(h,t,e){this.fn=h,this.context=t,this.once=e||!1}function U(h,t,e,i,n){if(typeof e!="function")throw new TypeError("The listener must be a function");var r=new ge(e,i||h,n),s=v?v+t:t;return h._events[s]?h._events[s].fn?h._events[s]=[h._events[s],r]:h._events[s].push(r):(h._events[s]=r,h._eventsCount++),h}function O(h,t){--h._eventsCount===0?h._events=new D:delete h._events[t]}function p(){this._events=new D,this._eventsCount=0}p.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)ce.call(e,i)&&t.push(v?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};p.prototype.listeners=function(t){var e=v?v+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,s=new Array(r);n<r;n++)s[n]=i[n].fn;return s};p.prototype.listenerCount=function(t){var e=v?v+t:t,i=this._events[e];return i?i.fn?1:i.length:0};p.prototype.emit=function(t,e,i,n,r,s){var o=v?v+t:t;if(!this._events[o])return!1;var a=this._events[o],l=arguments.length,g,c;if(a.fn){switch(a.once&&this.removeListener(t,a.fn,void 0,!0),l){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,i),!0;case 4:return a.fn.call(a.context,e,i,n),!0;case 5:return a.fn.call(a.context,e,i,n,r),!0;case 6:return a.fn.call(a.context,e,i,n,r,s),!0}for(c=1,g=new Array(l-1);c<l;c++)g[c-1]=arguments[c];a.fn.apply(a.context,g)}else{var m=a.length,u;for(c=0;c<m;c++)switch(a[c].once&&this.removeListener(t,a[c].fn,void 0,!0),l){case 1:a[c].fn.call(a[c].context);break;case 2:a[c].fn.call(a[c].context,e);break;case 3:a[c].fn.call(a[c].context,e,i);break;case 4:a[c].fn.call(a[c].context,e,i,n);break;default:if(!g)for(u=1,g=new Array(l-1);u<l;u++)g[u-1]=arguments[u];a[c].fn.apply(a[c].context,g)}}return!0};p.prototype.on=function(t,e,i){return U(this,t,e,i,!1)};p.prototype.once=function(t,e,i){return U(this,t,e,i,!0)};p.prototype.removeListener=function(t,e,i,n){var r=v?v+t:t;if(!this._events[r])return this;if(!e)return O(this,r),this;var s=this._events[r];if(s.fn)s.fn===e&&(!n||s.once)&&(!i||s.context===i)&&O(this,r);else{for(var o=0,a=[],l=s.length;o<l;o++)(s[o].fn!==e||n&&!s[o].once||i&&s[o].context!==i)&&a.push(s[o]);a.length?this._events[r]=a.length===1?a[0]:a:O(this,r)}return this};p.prototype.removeAllListeners=function(t){var e;return t?(e=v?v+t:t,this._events[e]&&O(this,e)):(this._events=new D,this._eventsCount=0),this};p.prototype.off=p.prototype.removeListener;p.prototype.addListener=p.prototype.on;p.prefixed=v;p.EventEmitter=p;typeof _!="undefined"&&(_.exports=p)});var Pe={};ae(Pe,{HighlightEngine:()=>N,MemoryManager:()=>M,PDFRenderer:()=>R,PerformanceOptimizer:()=>L,SalinaPDFViewer:()=>A,SearchEngine:()=>T,SelectionHighlightEngine:()=>P,SimpleHighlighter:()=>S,TextLayerHighlighter:()=>w,TextLayerSearchEngine:()=>C,VERSION:()=>Ce,VirtualScrolling:()=>F,clamp:()=>xe,debounce:()=>fe,deepMerge:()=>K,delay:()=>Z,downloadBlob:()=>X,downloadData:()=>He,formatFileSize:()=>Se,generateId:()=>me,getRangeRect:()=>be,isBrowser:()=>Y,isInViewport:()=>ye,isTouchDevice:()=>Ee,loadFile:()=>we,retry:()=>Te,throttle:()=>ve});var B=he(G(),1);var S=class{constructor(t){this.activeHighlight=null;this.highlightElements=[];this.copyHintElement=null;this.scale=1;this.options=t,this.setupEventListeners()}updateScale(t){this.scale=t,this.rerenderHighlights()}setupEventListeners(){document.addEventListener("mouseup",this.handleMouseUp.bind(this)),document.addEventListener("click",this.handleDocumentClick.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this))}handleMouseUp(){setTimeout(()=>{let t=window.getSelection();if(!t||!t.toString().trim()||t.rangeCount===0)return;let e=t.toString().trim(),i=t.getRangeAt(0),n=this.findPageNumber(i);if(!n)return;let r=document.getElementById(`page-${n}`);if(!r)return;let s=r.querySelector(".react-pdf__Page__textContent")||r.querySelector(".salina-pdf-text-layer");if(!s)return;let o=i.startContainer,a=i.endContainer,l=i.commonAncestorContainer;if(!(s.contains(o)||s.contains(a)||s.contains(l)))return;let c=this.createHighlightRectangles(i,r);c.length>0&&(this.setActiveHighlight({pageNumber:n,text:e,rectangles:c,timestamp:Date.now()}),setTimeout(()=>{t.removeAllRanges()},10))},10)}handleDocumentClick(t){let e=t.target;if(!e.closest(".salina-copy-hint")&&this.activeHighlight){let i=document.getElementById(`page-${this.activeHighlight.pageNumber}`);if(!(i!=null&&i.contains(e))){this.clearHighlights();return}let n=i.querySelector(".react-pdf__Page__textContent")||i.querySelector(".salina-pdf-text-layer");n&&!n.contains(e)&&!e.closest(".salina-highlight")&&this.clearHighlights()}}handleKeyDown(t){t.key==="Escape"?this.clearHighlights():(t.ctrlKey||t.metaKey)&&t.key==="c"&&this.activeHighlight&&(t.preventDefault(),this.copyToClipboard())}findPageNumber(t){let e=t.commonAncestorContainer;for(;e&&e!==document;){if(e.nodeType===Node.ELEMENT_NODE){let i=e;if(i.id&&i.id.match(/^page-\d+$/))return parseInt(i.id.replace("page-",""));let n=i.getAttribute("data-page-number");if(n)return parseInt(n);let r=i.closest('[id^="page-"]')||i.closest("[data-page-number]");if(r){if(r.id&&r.id.match(/^page-\d+$/))return parseInt(r.id.replace("page-",""));let s=r.getAttribute("data-page-number");if(s)return parseInt(s)}}e=e.parentNode}return null}createHighlightRectangles(t,e){let i=e.getBoundingClientRect(),n=t.getClientRects(),r=[];return Array.from(n).forEach(s=>{if(s.width>0&&s.height>0){let o=s.left-i.left,a=s.top-i.top;r.push({x:o/this.scale,y:a/this.scale,width:s.width/this.scale,height:s.height/this.scale})}}),r}setActiveHighlight(t){this.clearHighlights(),this.activeHighlight=t,this.renderHighlights(),this.options.copyHintEnabled&&this.renderCopyHint()}renderHighlights(){if(!this.activeHighlight)return;let t=document.getElementById(`page-${this.activeHighlight.pageNumber}`);t&&this.activeHighlight.rectangles.forEach((e,i)=>{let n=document.createElement("div");n.className="salina-highlight salina-simple-highlight",n.setAttribute("data-page",this.activeHighlight.pageNumber.toString()),n.title=this.activeHighlight.text,Object.assign(n.style,{position:"absolute",left:`${e.x*this.scale}px`,top:`${e.y*this.scale}px`,width:`${e.width*this.scale}px`,height:`${e.height*this.scale}px`,backgroundColor:this.options.highlightColor,borderRadius:"2px",pointerEvents:"none",zIndex:"5",mixBlendMode:"multiply",transition:"background-color 0.2s ease"}),t.appendChild(n),this.highlightElements.push(n)})}renderCopyHint(){if(!this.activeHighlight||this.activeHighlight.rectangles.length===0)return;let t=document.getElementById(`page-${this.activeHighlight.pageNumber}`);if(!t)return;let e=this.activeHighlight.rectangles[0],i=document.createElement("div");i.className="salina-copy-hint",Object.assign(i.style,{position:"absolute",left:`${e.x*this.scale}px`,top:`${(e.y-30)*this.scale}px`,zIndex:"10",animation:"fadeIn 0.3s ease-out",pointerEvents:"auto"});let n=document.createElement("div");n.className="salina-copy-hint-bubble",n.textContent="\u{1F4CB} Copy (Ctrl+C)",Object.assign(n.style,{background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',cursor:"pointer",userSelect:"none",whiteSpace:"nowrap",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease",opacity:"0.9"}),n.addEventListener("click",this.copyToClipboard.bind(this)),n.addEventListener("mouseenter",()=>{n.style.background="rgba(0, 0, 0, 0.9)",n.style.opacity="1",n.style.transform="translateY(-1px)"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(0, 0, 0, 0.8)",n.style.opacity="0.9",n.style.transform="translateY(0)"}),i.appendChild(n),t.appendChild(i),this.copyHintElement=i}copyToClipboard(){return f(this,null,function*(){if(this.activeHighlight)try{yield navigator.clipboard.writeText(this.activeHighlight.text),console.log("Highlighted text copied to clipboard:",this.activeHighlight.text),this.highlightElements.forEach(t=>{t.classList.add("copied"),t.style.backgroundColor="rgba(0, 255, 0, 0.6)",t.style.transform="scale(1.02)",setTimeout(()=>{t.classList.remove("copied"),t.style.backgroundColor=this.options.highlightColor,t.style.transform="scale(1)"},500)})}catch(t){console.error("Failed to copy text:",t)}})}rerenderHighlights(){this.activeHighlight&&(this.clearHighlights(),this.renderHighlights(),this.options.copyHintEnabled&&this.renderCopyHint())}clearHighlights(){this.highlightElements.forEach(t=>{t.remove()}),this.highlightElements=[],this.copyHintElement&&(this.copyHintElement.remove(),this.copyHintElement=null),this.activeHighlight=null}getActiveHighlight(){return this.activeHighlight}destroy(){this.clearHighlights(),document.removeEventListener("mouseup",this.handleMouseUp.bind(this)),document.removeEventListener("click",this.handleDocumentClick.bind(this)),document.removeEventListener("keydown",this.handleKeyDown.bind(this))}};var ue=[/(\.\*){2,}/,/(\+\*)|(\*\+)/,/(.*){2,}/,/(\(.+\+){2,}/];function de(h){if(h.length>100)return!1;let e=`\\b${h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`;return!ue.some(i=>i.test(e))}function pe(h){try{if(!de(h))return console.warn("Search query rejected for security reasons"),null;let t=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`\\b${t}\\b`,"g")}catch(t){return console.warn("Invalid regex pattern:",t),null}}var T=class{constructor(t){this.searchResults=[];this.searchElements=[];this.options=t}search(t,e){if(this.clearResults(),!t.trim())return[];let i=[],n=0,r=this.options.caseSensitive?t:t.toLowerCase(),s=this.options.wholeWords?pe(r):null;return this.options.wholeWords&&!s&&console.warn("Falling back to simple search due to invalid regex pattern"),e.forEach(o=>{o.items.forEach(a=>{if(!a.str.trim())return;let l=this.options.caseSensitive?a.str:a.str.toLowerCase();this.findMatchIndices(l,r,s).forEach(({index:c,length:m})=>{i.push({pageNumber:o.pageNumber,text:a.str.substr(c,m),position:{x:a.x,y:a.y,width:a.width,height:a.height},textIndex:n,context:this.getContext(a.str,c,m)}),n++})})}),this.searchResults=i,this.renderSearchResultsOptimized(),i}findMatchIndices(t,e,i){let n=[];if(i){i.lastIndex=0;let r,s=0,o=1e4;for(;(r=i.exec(t))!==null&&s<o;)n.push({index:r.index,length:r[0].length}),s++,r.index===i.lastIndex&&i.lastIndex++}else{let r=t.indexOf(e),s=0,o=1e4;for(;r!==-1&&s<o;)n.push({index:r,length:e.length}),r=t.indexOf(e,r+1),s++}return n}clearResults(){this.searchResults=[],this.clearSearchHighlights()}getResults(){return this.searchResults}destroy(){this.clearResults()}renderSearchResultsOptimized(){let t=new Map;this.searchResults.forEach((e,i)=>{t.has(e.pageNumber)||t.set(e.pageNumber,[]),t.get(e.pageNumber).push(q(d({},e),{originalIndex:i}))}),t.forEach((e,i)=>{this.renderPageHighlights(i,e)})}renderPageHighlights(t,e){let i=document.querySelector(`[data-page-number="${t}"]`);if(!i)return;let n=document.createDocumentFragment();e.forEach(r=>{let s=document.createElement("div");s.className="salina-search-highlight",s.setAttribute("data-search-index",r.originalIndex.toString()),s.style.cssText=`
        position: absolute;
        left: ${r.position.x}px;
        top: ${r.position.y}px;
        width: ${r.position.width}px;
        height: ${r.position.height}px;
        background-color: ${this.options.highlightColor};
        pointer-events: none;
        border-radius: 2px;
        z-index: 15;
        mix-blend-mode: multiply;
      `,n.appendChild(s),this.searchElements.push(s)}),i.appendChild(n)}clearSearchHighlights(){this.searchElements.forEach(t=>t.remove()),this.searchElements=[]}getContext(t,e,i){let r=Math.max(0,e-50),s=Math.min(t.length,e+i+50),o=t.substring(r,s);return r>0&&(o="..."+o),s<t.length&&(o=o+"..."),o}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}highlightSearchResult(t){this.searchElements.forEach(i=>i.classList.remove("current"));let e=this.searchElements[t];e&&(e.classList.add("current"),e.scrollIntoView({behavior:"smooth",block:"center"}))}};var w=class{constructor(){this.matches=new Map;this.selectedMatchIndex=-1;this.highlightClassName="salina-highlight";this.selectedClassName="salina-highlight-selected"}findTextInLayer(t,e,i=!1){let n=Array.from(t.querySelectorAll("span")),r=[];if(!n.length||!e)return r;let s=n.map(c=>c.textContent||"").join(""),o=i?e:e.toLowerCase(),a=i?s:s.toLowerCase(),l=0,g=0;for(;(g=a.indexOf(o,g))!==-1;){let c=g+o.length,m=0,u=-1,E=-1,b=-1,H=-1;for(let y=0;y<n.length;y++){let $=(n[y].textContent||"").length;if(u===-1&&m+$>g&&(u=y,E=g-m),m<c&&m+$>=c){b=y,H=c-m;break}m+=$}if(u!==-1&&b!==-1){let y=n.slice(u,b+1);r.push({pageIndex:parseInt(t.dataset.pageNumber||"0"),matchIndex:l++,textDivs:y,textContent:s.substring(g,c),begin:{divIdx:u,offset:E},end:{divIdx:b,offset:H}})}g=c}return r}highlightMatches(t,e=!0){let i=new Map;t.forEach(n=>{i.has(n.pageIndex)||i.set(n.pageIndex,[]),i.get(n.pageIndex).push(n)}),i.forEach((n,r)=>{this.highlightPageMatches(n,e)})}highlightPageMatches(t,e){t.sort((i,n)=>i.begin.divIdx!==n.begin.divIdx?i.begin.divIdx-n.begin.divIdx:i.begin.offset-n.begin.offset),t.forEach((i,n)=>{this.highlightMatch(i,e||n===this.selectedMatchIndex)})}highlightMatch(t,e=!1){let{begin:i,end:n,textDivs:r}=t;if(i.divIdx===n.divIdx)this.highlightTextRange(r[0],i.offset,n.offset,e);else for(let s=0;s<r.length;s++){let o=r[s];s===0?this.highlightTextRange(o,i.offset,o.textContent.length,e):s===r.length-1?this.highlightTextRange(o,0,n.offset,e):this.highlightTextRange(o,0,o.textContent.length,e)}}highlightTextRange(t,e,i,n){let r=t.textContent||"";if(e>=i||e<0||i>r.length)return;let s=t.firstChild;if(!s||s.nodeType!==Node.TEXT_NODE)return;let o=document.createElement("span");o.className=this.highlightClassName,n&&o.classList.add(this.selectedClassName),e>0&&s.splitText(e);let a=s.nextSibling||s;i<r.length&&a.splitText(i-e);let l=a.cloneNode(!0);o.appendChild(l),a.parentNode.replaceChild(o,a)}clearHighlights(){document.querySelectorAll(`.${this.highlightClassName}`).forEach(e=>{let i=e.parentNode;if(!i)return;let n=e.textContent||"",r=document.createTextNode(n);i.replaceChild(r,e),i.normalize()}),this.matches.clear(),this.selectedMatchIndex=-1}navigateToMatch(t){let e=Array.from(this.matches.values()).flat();if(t<0||t>=e.length)return;document.querySelectorAll(`.${this.selectedClassName}`).forEach(r=>{r.classList.remove(this.selectedClassName)}),this.selectedMatchIndex=t;let i=e[t];this.highlightMatch(i,!0),i.textDivs[0].scrollIntoView({behavior:"smooth",block:"center"})}getSelectionInfo(t){if(!t.rangeCount)return null;let e=t.getRangeAt(0),i=t.toString().trim();if(!i)return null;let n=Array.from(e.getClientRects());return{text:i,range:e,rects:n}}createHighlightFromSelection(t,e="yellow",i){let n=this.getSelectionInfo(t);if(!n)return null;let{range:r}=n,s=i||`highlight_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=document.createElement("span");o.className="salina-persistent-highlight",o.dataset.highlightId=s,o.style.backgroundColor=e,o.style.opacity="0.3",o.style.cursor="pointer";try{r.surroundContents(o)}catch(a){let l=r.extractContents();o.appendChild(l),r.insertNode(o)}return t.removeAllRanges(),s}removeHighlight(t){let e=document.querySelector(`[data-highlight-id="${t}"]`);if(!e)return;let i=e.parentNode;if(i){for(;e.firstChild;)i.insertBefore(e.firstChild,e);e.remove(),i.normalize()}}};var C=class{constructor(t={}){this.currentQuery="";this.currentMatchIndex=-1;this.matches=[];this.highlighter=new w,this.options=d({caseSensitive:!1,wholeWords:!1,highlightAll:!0},t)}search(t){if(this.clear(),!t.trim())return[];this.currentQuery=t;let e=[];return document.querySelectorAll(".salina-pdf-text-layer").forEach(n=>{let r=parseInt(n.dataset.pageNumber||"0"),s=this.searchInTextLayer(n,t);s.forEach((o,a)=>{let l=this.getMatchBounds(o);e.push({pageNumber:r,text:o.textContent,position:l,textIndex:e.length,context:this.getMatchContext(o)})}),this.matches.push(...s)}),this.options.highlightAll&&this.matches.length>0&&this.highlighter.highlightMatches(this.matches,!0),e}searchInTextLayer(t,e){let i=e;this.options.wholeWords;let n=this.highlighter.findTextInLayer(t,i,this.options.caseSensitive);return this.options.wholeWords?n.filter(r=>this.isWholeWordMatch(r)):n}isWholeWordMatch(t){let{textDivs:e,begin:i,end:n}=t,s=e[0].textContent||"";if(i.offset>0){let l=s[i.offset-1];if(l&&/\w/.test(l))return!1}let a=e[e.length-1].textContent||"";if(n.offset<a.length){let l=a[n.offset];if(l&&/\w/.test(l))return!1}return!0}getMatchBounds(t){let e=[];if(t.textDivs.forEach(o=>{let a=o.getBoundingClientRect();e.push(a)}),e.length===0)return{x:0,y:0,width:0,height:0};let i={x:Math.min(...e.map(o=>o.left)),y:Math.min(...e.map(o=>o.top)),width:0,height:0},n=Math.max(...e.map(o=>o.right)),r=Math.max(...e.map(o=>o.bottom));i.width=n-i.x,i.height=r-i.y;let s=t.textDivs[0].closest("[data-page-number]");if(s){let o=s.getBoundingClientRect();i.x-=o.left,i.y-=o.top}return i}getMatchContext(t,e=30){let i=t.textDivs.map(l=>l.textContent||"").join(""),n=t.textContent,r=i.indexOf(n);if(r===-1)return n;let s=Math.max(0,r-e),o=Math.min(i.length,r+n.length+e),a=i.substring(s,o);return s>0&&(a="..."+a),o<i.length&&(a=a+"..."),a}nextMatch(){this.matches.length!==0&&(this.currentMatchIndex=(this.currentMatchIndex+1)%this.matches.length,this.highlighter.navigateToMatch(this.currentMatchIndex))}previousMatch(){this.matches.length!==0&&(this.currentMatchIndex=this.currentMatchIndex-1,this.currentMatchIndex<0&&(this.currentMatchIndex=this.matches.length-1),this.highlighter.navigateToMatch(this.currentMatchIndex))}clear(){this.highlighter.clearHighlights(),this.matches=[],this.currentQuery="",this.currentMatchIndex=-1}setOptions(t){this.options=d(d({},this.options),t),this.currentQuery&&this.search(this.currentQuery)}getCurrentMatch(){return this.matches.length===0?null:{index:this.currentMatchIndex+1,total:this.matches.length}}destroy(){this.clear()}};var P=class{constructor(t={}){this.highlights=new Map;this.selectionHandler=null;this.highlighter=new w,this.options=d({defaultColor:"yellow",allowMultipleColors:!0,persistHighlights:!0,autoHighlight:!1},t),this.setupSelectionHandling()}setupSelectionHandling(){this.options.autoHighlight&&(this.selectionHandler=t=>{t.target.closest(".salina-pdf-text-layer")&&setTimeout(()=>{let i=window.getSelection();i&&i.toString().trim()&&this.createHighlightFromCurrentSelection()},10)},document.addEventListener("mouseup",this.selectionHandler))}createHighlightFromCurrentSelection(t=this.options.defaultColor){var g;let e=window.getSelection();if(!e||!e.rangeCount)return null;let i=this.highlighter.getSelectionInfo(e);if(!i)return null;let n=e.getRangeAt(0),r=n.commonAncestorContainer,s=(g=r instanceof Element?r:r.parentElement)==null?void 0:g.closest(".salina-pdf-text-layer");if(!s)return null;let o=parseInt(s.dataset.pageNumber||"1"),a=this.highlighter.createHighlightFromSelection(e,t);if(!a)return null;let l={id:a,text:i.text,color:t,position:this.rectsToPosition(i.rects,s),pageNumber:o,timestamp:Date.now(),rects:i.rects,serializedRange:this.serializeRange(n)};return this.highlights.set(a,l),this.addHighlightInteraction(a),this.emitHighlightEvent("create",l),l}rectsToPosition(t,e){if(t.length===0)return{x:0,y:0,width:0,height:0};let i=e.getBoundingClientRect(),n=Math.min(...t.map(a=>a.left))-i.left,r=Math.min(...t.map(a=>a.top))-i.top,s=Math.max(...t.map(a=>a.right))-i.left,o=Math.max(...t.map(a=>a.bottom))-i.top;return{x:n,y:r,width:s-n,height:o-r}}serializeRange(t){let e=t.startContainer,i=t.endContainer,n=this.getNodePath(e),r=this.getNodePath(i);return JSON.stringify({startPath:n,startOffset:t.startOffset,endPath:r,endOffset:t.endOffset})}getNodePath(t){let e=[],i=t;for(;i&&i.parentNode;){let n=i.parentNode,r=Array.from(n.childNodes).indexOf(i);if(e.unshift(r),i=n,i instanceof Element&&i.classList.contains("salina-pdf-text-layer"))break}return e}restoreHighlights(t){t.forEach(e=>{if(e.serializedRange)try{let i=this.deserializeRange(e.serializedRange,e.pageNumber);if(i){let n=window.getSelection();n==null||n.removeAllRanges(),n==null||n.addRange(i),this.highlighter.createHighlightFromSelection(n,e.color,e.id),n==null||n.removeAllRanges(),this.highlights.set(e.id,e),this.addHighlightInteraction(e.id)}}catch(i){console.warn("Failed to restore highlight:",i)}})}deserializeRange(t,e){try{let i=JSON.parse(t),n=document.querySelector(`[data-page-number="${e}"] .salina-pdf-text-layer`);if(!n)return null;let r=this.getNodeFromPath(n,i.startPath),s=this.getNodeFromPath(n,i.endPath);if(!r||!s)return null;let o=document.createRange();return o.setStart(r,i.startOffset),o.setEnd(s,i.endOffset),o}catch(i){return null}}getNodeFromPath(t,e){let i=t;for(let n of e){if(!i.childNodes[n])return null;i=i.childNodes[n]}return i}addHighlightInteraction(t){let e=document.querySelector(`[data-highlight-id="${t}"]`);e&&(e.addEventListener("click",i=>{i.stopPropagation();let n=this.highlights.get(t);n&&this.emitHighlightEvent("click",n)}),e.addEventListener("contextmenu",i=>{i.preventDefault(),i.stopPropagation();let n=this.highlights.get(t);n&&this.emitHighlightEvent("contextmenu",n)}),e.addEventListener("mouseenter",()=>{e.classList.add("salina-highlight-hover")}),e.addEventListener("mouseleave",()=>{e.classList.remove("salina-highlight-hover")}))}removeHighlight(t){let e=this.highlights.get(t);e&&(this.highlighter.removeHighlight(t),this.highlights.delete(t),this.emitHighlightEvent("remove",e))}updateHighlightColor(t,e){let i=this.highlights.get(t);if(!i)return;let n=document.querySelector(`[data-highlight-id="${t}"]`);n&&(n.style.backgroundColor=e,i.color=e,this.emitHighlightEvent("update",i))}getHighlights(){return Array.from(this.highlights.values())}getPageHighlights(t){return Array.from(this.highlights.values()).filter(e=>e.pageNumber===t)}clearHighlights(){this.highlights.forEach((t,e)=>{this.highlighter.removeHighlight(e)}),this.highlights.clear()}emitHighlightEvent(t,e){let i=new CustomEvent(`salina:highlight:${t}`,{detail:{highlight:e},bubbles:!0});document.dispatchEvent(i)}exportHighlights(){return this.getHighlights()}importHighlights(t){this.clearHighlights(),this.restoreHighlights(t)}destroy(){this.selectionHandler&&document.removeEventListener("mouseup",this.selectionHandler),this.clearHighlights()}};var x=null;function k(){return new Promise((h,t)=>{if(x){h(x);return}if(typeof window!="undefined"&&window.pdfjsLib){x=window.pdfjsLib,x.GlobalWorkerOptions.workerSrc||(x.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"),h(x);return}let e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",e.onload=()=>{window.pdfjsLib?(x=window.pdfjsLib,x.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",h(x)):t(new Error("PDF.js failed to load"))},e.onerror=()=>t(new Error("Failed to load PDF.js script")),document.head.appendChild(e)})}var R=class{constructor(t,e){this.pdfDocument=null;this.pages=new Map;this.scale=1;this.textContent=[];this.container=t,this.options=e,this.setupPDFWorker()}loadDocument(t){return f(this,null,function*(){try{if(this.pdfDocument)try{this.pdfDocument.destroy()}catch(r){console.warn("PDFRenderer: Error destroying previous document:",r)}let e=yield k(),i;t instanceof File?i=yield this.fileToArrayBuffer(t):i=t;let n=e.getDocument(i);return this.pdfDocument=yield n.promise,yield this.extractTextContent(),yield this.renderAllPages(),this.pdfDocument.numPages}catch(e){throw e.name==="RenderingCancelledException"?(console.warn("PDFRenderer: Rendering was cancelled (expected during cleanup)"),new Error("PDF rendering was cancelled")):new Error(`Failed to load PDF: ${e}`)}})}renderAllPages(){return f(this,null,function*(){if(!this.pdfDocument)return;yield new Promise(e=>requestAnimationFrame(e));let t=document.createDocumentFragment();for(let e=1;e<=this.pdfDocument.numPages;e++){let i=yield this.renderPage(e);t.appendChild(i),e%3===0&&(yield new Promise(n=>setTimeout(n,0)))}this.container.innerHTML="",this.container.appendChild(t)})}renderPage(t){return f(this,null,function*(){x||(yield k());let e=yield this.pdfDocument.getPage(t),i=e.getViewport({scale:this.scale}),n=document.createElement("div");n.className="salina-pdf-page",n.setAttribute("data-page-number",t.toString()),n.style.cssText=`
      position: relative;
      display: inline-block;
      margin: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background: white;
    `;let r=document.createElement("canvas"),s=r.getContext("2d");r.width=i.width,r.height=i.height,r.style.display="block",n.appendChild(r);try{yield e.render({canvasContext:s,viewport:i}).promise}catch(l){if(l.name==="RenderingCancelledException")return console.warn(`PDFRenderer: Rendering cancelled for page ${t}`),n;throw l}let o=null;(this.options.features.search||this.options.features.highlighting)&&(o=yield this.createTextLayer(e,i,n));let a={pageNumber:t,canvas:r,textLayer:o,scale:this.scale,viewport:i};return this.pages.set(t,a),n})}createTextLayer(t,e,i){return f(this,null,function*(){x||(yield k());let n=yield t.getTextContent(),r=document.createElement("div");return r.className="salina-pdf-text-layer",r.dataset.pageNumber=i.dataset.pageNumber||"1",r.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: auto;
      user-select: text;
    `,n.items.forEach(s=>{let o=x,a=o.Util.transform(o.Util.transform(e.transform,s.transform),[1,0,0,-1,0,0]),l=document.createElement("span");l.textContent=s.str,l.style.cssText=`
        position: absolute;
        left: ${a[4]}px;
        top: ${a[5]}px;
        font-size: ${Math.sqrt(a[0]*a[0]+a[1]*a[1])}px;
        font-family: sans-serif;
        pointer-events: auto;
        user-select: text;
      `,r.appendChild(l)}),i.appendChild(r),r})}setScale(t){this.scale=t,this.updatePageScale()}updatePageScale(){this.isInViewport()?this.renderVisiblePages():this.renderAllPages()}renderVisiblePages(){this.getVisiblePages().forEach(e=>{let i=this.container.querySelector(`[data-page-number="${e}"]`);i&&this.updatePageElement(i,e)})}getVisiblePages(){let t=this.container.getBoundingClientRect(),e=[];return this.pages.forEach((i,n)=>{let r=this.container.querySelector(`[data-page-number="${n}"]`);if(r){let s=r.getBoundingClientRect();s.bottom>=t.top&&s.top<=t.bottom&&e.push(n)}}),e}updatePageElement(t,e){return f(this,null,function*(){let i=yield this.pdfDocument.getPage(e),n=i.getViewport({scale:this.scale}),r=t.querySelector("canvas");if(r){r.width=n.width,r.height=n.height;let s=r.getContext("2d");yield i.render({canvasContext:s,viewport:n}).promise}})}isInViewport(){return this.container.clientHeight>0&&this.container.clientWidth>0}goToPage(t){let e=this.container.querySelector(`[data-page-number="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}calculateFitToWidthScale(){if(!this.pdfDocument||this.pages.size===0)return 1;let t=this.pages.values().next().value,e=this.container.clientWidth-40,i=t.viewport.width;return e/i}calculateFitToHeightScale(){if(!this.pdfDocument||this.pages.size===0)return 1;let t=this.pages.values().next().value,e=this.container.clientHeight-40,i=t.viewport.height;return e/i}getTextContent(){return this.textContent}handleResize(){if(this.options.zoom.fitToWidth){let t=this.calculateFitToWidthScale();this.setScale(t)}else if(this.options.zoom.fitToHeight){let t=this.calculateFitToHeightScale();this.setScale(t)}}destroy(){try{this.container&&(this.container.innerHTML=""),this.pdfDocument&&(this.pdfDocument.destroy(),this.pdfDocument=null),this.pages.clear(),this.textContent=[]}catch(t){console.warn("PDFRenderer: Error during destruction:",t)}}extractTextContent(){return f(this,null,function*(){if(!this.pdfDocument)return;this.textContent=[];let t=5,e=this.pdfDocument.numPages;for(let i=1;i<=e;i+=t){let n=Math.min(i+t-1,e),r=[];for(let o=i;o<=n;o++)r.push(this.extractPageTextContent(o));let s=yield Promise.all(r);this.textContent.push(...s),n<e&&(yield new Promise(o=>setTimeout(o,0)))}})}extractPageTextContent(t){return f(this,null,function*(){x||(yield k());let e=yield this.pdfDocument.getPage(t),i=yield e.getTextContent(),n=e.getViewport({scale:1});return{pageNumber:t,items:i.items.map(r=>{let s=x,o=s.Util.transform(s.Util.transform(n.transform,r.transform),[1,0,0,-1,0,0]);return{str:r.str,x:o[4],y:o[5],width:r.width,height:r.height}})}})}setupPDFWorker(){}fileToArrayBuffer(t){return f(this,null,function*(){return new Promise((e,i)=>{let n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>i(n.error),n.readAsArrayBuffer(t)})})}};var A=class extends B.default{constructor(e){super();this.plugins=new Map;this.container=e.container,this.options=this.mergeOptions(e),this.state=this.initializeState(),this.pdfRenderer=new R(this.container,this.options),this.simpleHighlighter=new S({highlightColor:this.options.highlighting.defaultColor||"rgba(255, 255, 0, 0.3)",copyHintEnabled:!0}),this.searchEngine=new T({highlightColor:this.options.search.highlightColor||"rgba(255, 165, 0, 0.6)",caseSensitive:this.options.search.caseSensitive||!1,wholeWords:this.options.search.wholeWords||!1}),this.textLayerSearchEngine=new C({caseSensitive:this.options.search.caseSensitive||!1,wholeWords:this.options.search.wholeWords||!1,highlightAll:!0}),this.selectionHighlightEngine=new P({defaultColor:this.options.highlighting.defaultColor||"yellow",allowMultipleColors:!0,persistHighlights:!0,autoHighlight:this.options.highlighting.enableManualHighlighting||!1}),this.setupContainer(),this.setupEventListeners(),this.setupResizeObserver(),e.file&&this.loadDocument(e.file)}loadDocument(e){return f(this,null,function*(){var i,n,r,s;try{this.setState({isLoading:!0,error:null});let o=yield this.pdfRenderer.loadDocument(e);this.setState({totalPages:o,currentPage:1,isLoading:!1}),this.emit("document:loaded",o),(n=(i=this.options.callbacks).onLoad)==null||n.call(i,o)}catch(o){let a=o instanceof Error?o:new Error(String(o));throw this.setState({error:a.message,isLoading:!1}),this.emit("document:error",a),(s=(r=this.options.callbacks).onError)==null||s.call(r,a),a}})}destroy(){var e;(e=this.resizeObserver)==null||e.disconnect(),this.pdfRenderer.destroy(),this.simpleHighlighter.destroy(),this.searchEngine.destroy(),this.textLayerSearchEngine.destroy(),this.selectionHighlightEngine.destroy(),this.removeAllListeners(),this.container.innerHTML=""}goToPage(e){var i,n;e<1||e>this.state.totalPages||(this.setState({currentPage:e}),this.pdfRenderer.goToPage(e),this.emit("page:changed",e,this.state.totalPages),(n=(i=this.options.callbacks).onPageChange)==null||n.call(i,e,this.state.totalPages))}nextPage(){this.goToPage(this.state.currentPage+1)}prevPage(){this.goToPage(this.state.currentPage-1)}zoomIn(){let e=Math.min(this.options.zoom.max,this.state.scale+this.options.zoom.step);this.setZoom(e)}zoomOut(){let e=Math.max(this.options.zoom.min,this.state.scale-this.options.zoom.step);this.setZoom(e)}setZoom(e){var n,r;let i=Math.max(this.options.zoom.min,Math.min(this.options.zoom.max,e));i!==this.state.scale&&(this.state.scale=i,this.simpleHighlighter.updateScale(i),this.pdfRenderer.setScale(i),this.emit("zoom:changed",i),(r=(n=this.options.callbacks).onZoom)==null||r.call(n,i))}fitToWidth(){if(!this.container)return;let e=this.pdfRenderer.calculateFitToWidthScale();this.setZoom(e)}fitToHeight(){if(!this.container)return;let e=this.pdfRenderer.calculateFitToHeightScale();this.setZoom(e)}search(e){var n,r;if(!e.trim())return this.clearSearch(),[];this.setState({searchQuery:e});let i=this.searchEngine.search(e,this.pdfRenderer.getTextContent());return this.setState({searchResults:i,currentSearchIndex:i.length>0?0:-1}),this.emit("search:results",i),(r=(n=this.options.callbacks).onSearch)==null||r.call(n,i),i}searchInTextLayer(e){var n,r;if(!e.trim())return this.clearTextLayerSearch(),[];this.setState({searchQuery:e});let i=this.textLayerSearchEngine.search(e);return this.setState({searchResults:i,currentSearchIndex:i.length>0?0:-1}),this.emit("search:results",i),(r=(n=this.options.callbacks).onSearch)==null||r.call(n,i),i}clearSearch(){this.setState({searchQuery:"",searchResults:[],currentSearchIndex:-1}),this.searchEngine.clearResults(),this.emit("search:cleared")}clearTextLayerSearch(){this.setState({searchQuery:"",searchResults:[],currentSearchIndex:-1}),this.textLayerSearchEngine.clear(),this.emit("search:cleared")}nextSearchResult(){if(this.state.searchResults.length===0)return;let e=(this.state.currentSearchIndex+1)%this.state.searchResults.length;this.setState({currentSearchIndex:e});let i=this.state.searchResults[e];this.goToPage(i.pageNumber)}prevSearchResult(){if(this.state.searchResults.length===0)return;let e=this.state.currentSearchIndex===0?this.state.searchResults.length-1:this.state.currentSearchIndex-1;this.setState({currentSearchIndex:e});let i=this.state.searchResults[e];this.goToPage(i.pageNumber)}nextTextLayerSearchResult(){this.textLayerSearchEngine.nextMatch()}prevTextLayerSearchResult(){this.textLayerSearchEngine.previousMatch()}getCurrentSearchMatch(){return this.textLayerSearchEngine.getCurrentMatch()}getActiveHighlight(){return this.simpleHighlighter.getActiveHighlight()}clearHighlights(){this.simpleHighlighter.clearHighlights(),this.selectionHighlightEngine.clearHighlights(),this.emit("highlight:cleared")}createHighlightFromSelection(e){let i=this.selectionHighlightEngine.createHighlightFromCurrentSelection(e);return i?(this.emit("highlight:created",i),!0):!1}removeHighlight(e){this.selectionHighlightEngine.removeHighlight(e),this.emit("highlight:removed",e)}updateHighlightColor(e,i){this.selectionHighlightEngine.updateHighlightColor(e,i),this.emit("highlight:updated",e,i)}getHighlights(){return this.selectionHighlightEngine.getHighlights()}getPageHighlights(e){return this.selectionHighlightEngine.getPageHighlights(e)}exportHighlights(){return this.selectionHighlightEngine.exportHighlights()}importHighlights(e){this.selectionHighlightEngine.importHighlights(e),this.emit("highlights:imported",e.length)}addSimpleHighlight(){console.warn("addSimpleHighlight: Simple highlighter only supports mouse-based highlighting")}removeSimpleHighlight(){return this.clearHighlights(),!0}getSimpleHighlights(){let e=this.getActiveHighlight();return e?[e]:[]}exportSimpleHighlights(){let e=this.getActiveHighlight();return JSON.stringify(e?[e]:[],null,2)}importSimpleHighlights(){console.warn("importSimpleHighlights: Simple highlighter doesn't support highlight importing")}use(e){if(this.plugins.has(e.name))throw new Error(`Plugin '${e.name}' is already installed`);e.install(this),this.plugins.set(e.name,e)}unuse(e){let i=this.plugins.get(e);i&&(i.uninstall(this),this.plugins.delete(e))}getCurrentPage(){return this.state.currentPage}getTotalPages(){return this.state.totalPages}getScale(){return this.state.scale}getSearchResults(){return this.state.searchResults}getCurrentSearchIndex(){return this.state.currentSearchIndex}isLoading(){return this.state.isLoading}getError(){return this.state.error}mergeOptions(e){var i,n,r,s,o,a,l,g,c,m,u,E,b,H,y,z;return{container:e.container,file:(i=e.file)!=null?i:void 0,theme:(n=e.theme)!=null?n:"light",width:(r=e.width)!=null?r:"100%",height:(s=e.height)!=null?s:"100%",features:d({highlighting:!0,search:!0,navigation:!0,zoom:!0,fullscreen:!1,print:!1,download:!1,export:!0,annotations:!1},e.features),highlighting:d({defaultColor:"rgba(255, 255, 0, 0.3)",allowMultipleColors:!1,persistHighlights:!1},e.highlighting),search:d({highlightColor:"rgba(255, 165, 0, 0.6)",caseSensitive:!1,wholeWords:!1},e.search),zoom:d({min:(a=(o=e.zoom)==null?void 0:o.min)!=null?a:.5,max:(g=(l=e.zoom)==null?void 0:l.max)!=null?g:3,step:(m=(c=e.zoom)==null?void 0:c.step)!=null?m:.2,default:(E=(u=e.zoom)==null?void 0:u.default)!=null?E:1,fitToWidth:(H=(b=e.zoom)==null?void 0:b.fitToWidth)!=null?H:!0,fitToHeight:(z=(y=e.zoom)==null?void 0:y.fitToHeight)!=null?z:!0},e.zoom),callbacks:d({onLoad:()=>{},onPageChange:()=>{},onSearch:()=>{},onHighlight:()=>{},onHighlightRemove:()=>{},onError:()=>{},onZoom:()=>{}},e.callbacks)}}initializeState(){return{currentPage:1,totalPages:0,scale:this.options.zoom.default,isLoading:!1,error:null,searchQuery:"",searchResults:[],currentSearchIndex:-1}}setState(e){Object.assign(this.state,e)}setupContainer(){this.container.classList.add("salina-pdf-viewer"),this.container.setAttribute("data-theme",this.options.theme),typeof this.options.width=="number"?this.container.style.width=`${this.options.width}px`:this.container.style.width=this.options.width,typeof this.options.height=="number"?this.container.style.height=`${this.options.height}px`:this.container.style.height=this.options.height}setupEventListeners(){document.addEventListener("keydown",n=>{if(n.ctrlKey||n.metaKey)switch(n.key){case"f":case"F":this.options.features.search&&(n.preventDefault(),this.emit("search:focus"));break;case"+":case"=":n.preventDefault(),this.zoomIn();break;case"-":n.preventDefault(),this.zoomOut();break;case"0":n.preventDefault(),this.setZoom(1);break}});let e,i=()=>{clearTimeout(e),e=window.setTimeout(()=>{},100)};this.container.addEventListener("scroll",i),window.addEventListener("scroll",i),window.addEventListener("resize",()=>{this.pdfRenderer.handleResize()})}setupResizeObserver(){typeof ResizeObserver!="undefined"&&(this.resizeObserver=new ResizeObserver(()=>{this.pdfRenderer.handleResize()}),this.resizeObserver.observe(this.container))}};var N=class{constructor(t){this.highlights=new Map;this.highlightElements=new Map;this.scale=1;this.options=t,console.log("HighlightEngine initialized with options:",t)}addHighlight(t){this.highlights.set(t.id,t),this.renderHighlight(t)}removeHighlight(t){this.highlights.delete(t);let e=this.highlightElements.get(t);e&&(e.remove(),this.highlightElements.delete(t))}clearHighlights(){this.highlights.clear(),this.highlightElements.forEach(t=>t.remove()),this.highlightElements.clear()}updateScale(t){this.scale=t,this.highlights.forEach(e=>this.renderHighlight(e))}getHighlights(){return Array.from(this.highlights.values())}getHighlightById(t){return this.highlights.get(t)}destroy(){this.clearHighlights()}handleViewportChange(){this.highlights.forEach(t=>this.renderHighlight(t))}updateVisibleHighlights(){let t={top:window.scrollY,bottom:window.scrollY+window.innerHeight,left:window.scrollX,right:window.scrollX+window.innerWidth};this.highlights.forEach((e,i)=>{let n=this.highlightElements.get(i);if(n){let r=n.getBoundingClientRect();!(r.bottom<t.top||r.top>t.bottom||r.right<t.left||r.left>t.right)&&this.renderHighlight(e)}})}getPositionInfo(t){let e=document.querySelector(`[data-page-number="${t}"]`);if(!e)return null;let i=e.querySelector(".textLayer")||e.querySelector(".react-pdf__Page__textContent")||e.querySelector(".salina-pdf-text-layer"),n=e.getBoundingClientRect(),r=(i==null?void 0:i.getBoundingClientRect())||null,s=e.closest(".salina-pdf-viewer, .pdf-container, .pdf-viewer"),o={x:(s==null?void 0:s.scrollLeft)||0,y:(s==null?void 0:s.scrollTop)||0};return{pageContainer:e,textLayer:i,containerRect:n,textLayerRect:r,scrollOffset:o}}renderHighlight(t){let e=this.highlightElements.get(t.id);e&&e.remove();let i=this.getPositionInfo(t.pageNumber);if(!i)return;let{pageContainer:n,textLayer:r,containerRect:s,textLayerRect:o,scrollOffset:a}=i,l=document.createElement("div");l.className="salina-highlight",l.setAttribute("data-highlight-id",t.id),l.title=t.text;let g={x:t.position.x*this.scale,y:t.position.y*this.scale,width:t.position.width*this.scale,height:t.position.height*this.scale};Object.assign(l.style,{position:"absolute",left:`${g.x}px`,top:`${g.y}px`,width:`${g.width}px`,height:`${g.height}px`,backgroundColor:t.color,pointerEvents:"auto",borderRadius:"2px",zIndex:"10",mixBlendMode:"multiply",opacity:"0.4",transition:"opacity 0.2s ease, transform 0.2s ease",cursor:"pointer",outline:"1px solid transparent",boxSizing:"border-box"}),l.addEventListener("click",c=>{c.stopPropagation(),this.handleHighlightClick(t)}),l.addEventListener("mouseenter",()=>{l.style.opacity="0.6",l.style.transform="scale(1.01)",l.style.outline="1px solid rgba(0, 123, 255, 0.3)"}),l.addEventListener("mouseleave",()=>{l.style.opacity="0.4",l.style.transform="scale(1)",l.style.outline="1px solid transparent"}),n.appendChild(l),this.highlightElements.set(t.id,l)}createHighlightFromSelection(t,e,i=this.options.defaultColor){if(!t.rangeCount)return null;let n=t.getRangeAt(0),r=t.toString().trim();if(!r)return null;let s=this.getPositionInfo(e);if(!s)return null;let{pageContainer:o,containerRect:a}=s,l=n.getClientRects(),g=[];return Array.from(l).forEach((c,m)=>{if(c.width>0&&c.height>0){let u=c.left-a.left,E=c.top-a.top,b={x:u/this.scale,y:E/this.scale,width:c.width/this.scale,height:c.height/this.scale},H={id:this.generateHighlightId(),text:r,color:i,position:b,pageNumber:e,timestamp:Date.now()};g.push(H),this.addHighlight(H)}}),g.length>0?g:null}generateHighlightId(){return`highlight_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}handleHighlightClick(t){let e=new CustomEvent("salina:highlight:click",{detail:{highlight:t},bubbles:!0});document.dispatchEvent(e)}};function me(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36)}function fe(h,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>h(...i),t)}}function ve(h,t){let e;return(...i)=>{e||(h(...i),e=!0,setTimeout(()=>e=!1,t))}}function xe(h,t,e){return Math.min(Math.max(h,t),e)}function ye(h){let t=h.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function be(h){let t=h.getClientRects();if(t.length===0)throw new Error("Range has no client rects");let e=1/0,i=1/0,n=-1/0,r=-1/0;for(let s=0;s<t.length;s++){let o=t[s];e=Math.min(e,o.left),i=Math.min(i,o.top),n=Math.max(n,o.right),r=Math.max(r,o.bottom)}return new DOMRect(e,i,n-e,r-i)}function X(h,t){let e=URL.createObjectURL(h),i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e)}function He(h,t,e="application/json"){let i=new Blob([h],{type:e});X(i,t)}function we(h){return new Promise((t,e)=>{let i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>e(i.error),i.readAsText(h)})}function K(h,t){let e=d({},h);for(let i in t)if(t.hasOwnProperty(i)){let n=t[i],r=e[i];n&&typeof n=="object"&&!Array.isArray(n)&&r&&typeof r=="object"&&!Array.isArray(r)?e[i]=K(r,n):e[i]=n}return e}function Y(){return typeof window!="undefined"&&typeof document!="undefined"}function Ee(){return Y()&&("ontouchstart"in window||navigator.maxTouchPoints>0)}function Se(h){let t=["B","KB","MB","GB"],e=h,i=0;for(;e>=1024&&i<t.length-1;)e/=1024,i++;return`${e.toFixed(1)} ${t[i]}`}function Z(h){return new Promise(t=>setTimeout(t,h))}function Te(h,t=3,e=1e3){return f(this,null,function*(){let i;for(let n=1;n<=t;n++)try{return yield h()}catch(r){if(i=r,n===t)break;let s=e*Math.pow(2,n-1);yield Z(s)}throw i})}var L=class{static debounce(t,e){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>t(...n),e)}}static throttle(t,e){let i;return(...n)=>{i||(t(...n),i=!0,setTimeout(()=>i=!1,e))}}static queueTask(t){this.taskQueue.push(t),this.rafId===null&&(this.rafId=requestAnimationFrame(()=>{this.processTasks(),this.rafId=null}))}static processTasks(){this.taskQueue.splice(0).forEach(e=>{try{e()}catch(i){console.error("Task execution error:",i)}})}static createCancellableTimeout(t,e){let i=setTimeout(t,e);return{cancel:()=>clearTimeout(i)}}static measurePerformance(t,e){let i=performance.now(),n=e(),r=performance.now();return console.log(`${t} took ${r-i} milliseconds`),n}static createPerformanceObserver(t){if(typeof PerformanceObserver=="undefined")return null;let e=new PerformanceObserver(i=>{t(i.getEntries())});try{return e.observe({entryTypes:["measure","navigation","paint"]}),e}catch(i){return console.warn("Performance observer not supported:",i),null}}};L.rafId=null,L.taskQueue=[];var M=class{static setCache(t,e){if(this.cache.size>=this.maxCacheSize){let i=this.cache.keys().next().value;this.cache.delete(i)}this.cache.set(t,e)}static getCache(t){return this.cache.get(t)||null}static clearCache(){this.cache.clear()}static getMemoryUsage(){return"memory"in performance?performance.memory:null}static forceGC(){"gc"in window&&typeof window.gc=="function"&&window.gc()}};M.cache=new Map,M.maxCacheSize=50;var F=class{constructor(t,e){this.visibleRange={start:0,end:0};this.totalItems=0;this.container=t,this.itemHeight=e,console.log("VirtualScrolling initialized for container:",t.tagName)}calculateVisibleRange(t,e){let i=Math.floor(t/this.itemHeight),n=Math.ceil(e/this.itemHeight),r=Math.min(i+n+1,this.totalItems-1);return this.visibleRange={start:Math.max(0,i-1),end:r},this.visibleRange}getVisibleRange(){return this.visibleRange}setTotalItems(t){this.totalItems=t}getTotalHeight(){return this.totalItems*this.itemHeight}};var Ce="3.0.2";return le(Pe);})();
//# sourceMappingURL=index.global.js.map