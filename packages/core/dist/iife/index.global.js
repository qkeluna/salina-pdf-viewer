var SalinaPDFViewer=(()=>{var Z=Object.create;var T=Object.defineProperty,Q=Object.defineProperties,G=Object.getOwnPropertyDescriptor,J=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,X=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var j=(a,t,e)=>t in a?T(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,f=(a,t)=>{for(var e in t||(t={}))A.call(t,e)&&j(a,e,t[e]);if(V)for(var e of V(t))Y.call(t,e)&&j(a,e,t[e]);return a},L=(a,t)=>Q(a,J(t));var ee=(a,t)=>()=>(t||a((t={exports:{}}).exports,t),t.exports),te=(a,t)=>{for(var e in t)T(a,e,{get:t[e],enumerable:!0})},_=(a,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of K(t))!A.call(a,n)&&n!==e&&T(a,n,{get:()=>t[n],enumerable:!(i=G(t,n))||i.enumerable});return a};var ie=(a,t,e)=>(e=a!=null?Z(X(a)):{},_(t||!a||!a.__esModule?T(e,"default",{value:a,enumerable:!0}):e,a)),ne=a=>_(T({},"__esModule",{value:!0}),a);var p=(a,t,e)=>new Promise((i,n)=>{var s=o=>{try{h(e.next(o))}catch(l){n(l)}},r=o=>{try{h(e.throw(o))}catch(l){n(l)}},h=o=>o.done?i(o.value):Promise.resolve(o.value).then(s,r);h((e=e.apply(a,t)).next())});var W=ee((we,F)=>{"use strict";var se=Object.prototype.hasOwnProperty,d="~";function H(){}Object.create&&(H.prototype=Object.create(null),new H().__proto__||(d=!1));function re(a,t,e){this.fn=a,this.context=t,this.once=e||!1}function $(a,t,e,i,n){if(typeof e!="function")throw new TypeError("The listener must be a function");var s=new re(e,i||a,n),r=d?d+t:t;return a._events[r]?a._events[r].fn?a._events[r]=[a._events[r],s]:a._events[r].push(s):(a._events[r]=s,a._eventsCount++),a}function M(a,t){--a._eventsCount===0?a._events=new H:delete a._events[t]}function u(){this._events=new H,this._eventsCount=0}u.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)se.call(e,i)&&t.push(d?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};u.prototype.listeners=function(t){var e=d?d+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,r=new Array(s);n<s;n++)r[n]=i[n].fn;return r};u.prototype.listenerCount=function(t){var e=d?d+t:t,i=this._events[e];return i?i.fn?1:i.length:0};u.prototype.emit=function(t,e,i,n,s,r){var h=d?d+t:t;if(!this._events[h])return!1;var o=this._events[h],l=arguments.length,g,c;if(o.fn){switch(o.once&&this.removeListener(t,o.fn,void 0,!0),l){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,e),!0;case 3:return o.fn.call(o.context,e,i),!0;case 4:return o.fn.call(o.context,e,i,n),!0;case 5:return o.fn.call(o.context,e,i,n,s),!0;case 6:return o.fn.call(o.context,e,i,n,s,r),!0}for(c=1,g=new Array(l-1);c<l;c++)g[c-1]=arguments[c];o.fn.apply(o.context,g)}else{var b=o.length,v;for(c=0;c<b;c++)switch(o[c].once&&this.removeListener(t,o[c].fn,void 0,!0),l){case 1:o[c].fn.call(o[c].context);break;case 2:o[c].fn.call(o[c].context,e);break;case 3:o[c].fn.call(o[c].context,e,i);break;case 4:o[c].fn.call(o[c].context,e,i,n);break;default:if(!g)for(v=1,g=new Array(l-1);v<l;v++)g[v-1]=arguments[v];o[c].fn.apply(o[c].context,g)}}return!0};u.prototype.on=function(t,e,i){return $(this,t,e,i,!1)};u.prototype.once=function(t,e,i){return $(this,t,e,i,!0)};u.prototype.removeListener=function(t,e,i,n){var s=d?d+t:t;if(!this._events[s])return this;if(!e)return M(this,s),this;var r=this._events[s];if(r.fn)r.fn===e&&(!n||r.once)&&(!i||r.context===i)&&M(this,s);else{for(var h=0,o=[],l=r.length;h<l;h++)(r[h].fn!==e||n&&!r[h].once||i&&r[h].context!==i)&&o.push(r[h]);o.length?this._events[s]=o.length===1?o[0]:o:M(this,s)}return this};u.prototype.removeAllListeners=function(t){var e;return t?(e=d?d+t:t,this._events[e]&&M(this,e)):(this._events=new H,this._eventsCount=0),this};u.prototype.off=u.prototype.removeListener;u.prototype.addListener=u.prototype.on;u.prefixed=d;u.EventEmitter=u;typeof F!="undefined"&&(F.exports=u)});var ve={};te(ve,{HighlightEngine:()=>w,MemoryManager:()=>P,PDFRenderer:()=>y,PerformanceOptimizer:()=>E,SalinaPDFViewer:()=>k,SearchEngine:()=>x,VERSION:()=>fe,VirtualScrolling:()=>O,clamp:()=>he,debounce:()=>oe,deepMerge:()=>N,delay:()=>U,downloadBlob:()=>B,downloadData:()=>ge,formatFileSize:()=>pe,generateId:()=>z,getRangeRect:()=>ce,isBrowser:()=>q,isInViewport:()=>le,isTouchDevice:()=>de,loadFile:()=>ue,retry:()=>me,throttle:()=>ae});var I=ie(W(),1);var w=class{constructor(t){this.highlights=new Map;this.highlightElements=new Map;this.scale=1;this.options=t,console.log("HighlightEngine initialized with options:",t)}addHighlight(t){this.highlights.set(t.id,t),this.renderHighlight(t)}removeHighlight(t){this.highlights.delete(t);let e=this.highlightElements.get(t);e&&(e.remove(),this.highlightElements.delete(t))}clearHighlights(){this.highlights.clear(),this.highlightElements.forEach(t=>t.remove()),this.highlightElements.clear()}updateScale(t){this.scale=t,this.highlights.forEach(e=>this.renderHighlight(e))}getHighlights(){return Array.from(this.highlights.values())}getHighlightById(t){return this.highlights.get(t)}destroy(){this.clearHighlights()}handleViewportChange(){this.highlights.forEach(t=>this.renderHighlight(t))}updateVisibleHighlights(){let t={top:window.scrollY,bottom:window.scrollY+window.innerHeight,left:window.scrollX,right:window.scrollX+window.innerWidth};this.highlights.forEach((e,i)=>{let n=this.highlightElements.get(i);if(n){let s=n.getBoundingClientRect();!(s.bottom<t.top||s.top>t.bottom||s.right<t.left||s.left>t.right)&&this.renderHighlight(e)}})}getPositionInfo(t){let e=document.querySelector(`[data-page-number="${t}"]`);if(!e)return null;let i=e.querySelector(".textLayer")||e.querySelector(".react-pdf__Page__textContent")||e.querySelector(".salina-pdf-text-layer"),n=e.getBoundingClientRect(),s=(i==null?void 0:i.getBoundingClientRect())||null,r=e.closest(".salina-pdf-viewer, .pdf-container, .pdf-viewer"),h={x:(r==null?void 0:r.scrollLeft)||0,y:(r==null?void 0:r.scrollTop)||0};return{pageContainer:e,textLayer:i,containerRect:n,textLayerRect:s,scrollOffset:h}}renderHighlight(t){let e=this.highlightElements.get(t.id);e&&e.remove();let i=this.getPositionInfo(t.pageNumber);if(!i)return;let{pageContainer:n,textLayer:s,containerRect:r,textLayerRect:h,scrollOffset:o}=i,l=document.createElement("div");l.className="salina-highlight",l.setAttribute("data-highlight-id",t.id),l.title=t.text;let g={x:t.position.x*this.scale,y:t.position.y*this.scale,width:t.position.width*this.scale,height:t.position.height*this.scale};Object.assign(l.style,{position:"absolute",left:`${g.x}px`,top:`${g.y}px`,width:`${g.width}px`,height:`${g.height}px`,backgroundColor:t.color,pointerEvents:"auto",borderRadius:"2px",zIndex:"10",mixBlendMode:"multiply",opacity:"0.4",transition:"opacity 0.2s ease, transform 0.2s ease",cursor:"pointer",outline:"1px solid transparent",boxSizing:"border-box"}),l.addEventListener("click",c=>{c.stopPropagation(),this.handleHighlightClick(t)}),l.addEventListener("mouseenter",()=>{l.style.opacity="0.6",l.style.transform="scale(1.01)",l.style.outline="1px solid rgba(0, 123, 255, 0.3)"}),l.addEventListener("mouseleave",()=>{l.style.opacity="0.4",l.style.transform="scale(1)",l.style.outline="1px solid transparent"}),n.appendChild(l),this.highlightElements.set(t.id,l)}createHighlightFromSelection(t,e,i=this.options.defaultColor){if(!t.rangeCount)return null;let n=t.getRangeAt(0),s=t.toString().trim();if(!s)return null;let r=this.getPositionInfo(e);if(!r)return null;let{pageContainer:h,containerRect:o}=r,l=n.getClientRects(),g=[];return Array.from(l).forEach((c,b)=>{if(c.width>0&&c.height>0){let v=c.left-o.left,R=c.top-o.top,C={x:v/this.scale,y:R/this.scale,width:c.width/this.scale,height:c.height/this.scale},S={id:this.generateHighlightId(),text:s,color:i,position:C,pageNumber:e,timestamp:Date.now()};g.push(S),this.addHighlight(S)}}),g.length>0?g:null}generateHighlightId(){return`highlight_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}handleHighlightClick(t){let e=new CustomEvent("salina:highlight:click",{detail:{highlight:t},bubbles:!0});document.dispatchEvent(e)}};var x=class{constructor(t){this.searchResults=[];this.searchElements=[];this.options=t}search(t,e){if(this.clearResults(),!t.trim())return[];let i=[],n=0,s=this.options.caseSensitive?t:t.toLowerCase(),r=this.options.wholeWords?new RegExp(`\\b${this.escapeRegExp(s)}\\b`,"g"):null;return e.forEach(h=>{h.items.forEach(o=>{if(!o.str.trim())return;let l=this.options.caseSensitive?o.str:o.str.toLowerCase();this.findMatchIndices(l,s,r).forEach(c=>{i.push({pageNumber:h.pageNumber,text:o.str.substr(c,t.length),position:{x:o.x,y:o.y,width:o.width,height:o.height},textIndex:n,context:this.getContext(o.str,c,t.length)}),n++})})}),this.searchResults=i,this.renderSearchResultsOptimized(),i}findMatchIndices(t,e,i){let n=[];if(i){i.lastIndex=0;let s;for(;(s=i.exec(t))!==null;)n.push(s.index)}else{let s=t.indexOf(e);for(;s!==-1;)n.push(s),s=t.indexOf(e,s+1)}return n}clearResults(){this.searchResults=[],this.clearSearchHighlights()}getResults(){return this.searchResults}destroy(){this.clearResults()}renderSearchResultsOptimized(){let t=new Map;this.searchResults.forEach((e,i)=>{t.has(e.pageNumber)||t.set(e.pageNumber,[]),t.get(e.pageNumber).push(L(f({},e),{originalIndex:i}))}),t.forEach((e,i)=>{this.renderPageHighlights(i,e)})}renderPageHighlights(t,e){let i=document.querySelector(`[data-page-number="${t}"]`);if(!i)return;let n=document.createDocumentFragment();e.forEach(s=>{let r=document.createElement("div");r.className="salina-search-highlight",r.setAttribute("data-search-index",s.originalIndex.toString()),r.style.cssText=`
        position: absolute;
        left: ${s.position.x}px;
        top: ${s.position.y}px;
        width: ${s.position.width}px;
        height: ${s.position.height}px;
        background-color: ${this.options.highlightColor};
        pointer-events: none;
        border-radius: 2px;
        z-index: 15;
      `,n.appendChild(r),this.searchElements.push(r)}),i.appendChild(n)}clearSearchHighlights(){this.searchElements.forEach(t=>t.remove()),this.searchElements=[]}getContext(t,e,i){let s=Math.max(0,e-50),r=Math.min(t.length,e+i+50),h=t.substring(s,r);return s>0&&(h="..."+h),r<t.length&&(h=h+"..."),h}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}highlightSearchResult(t){this.searchElements.forEach(i=>i.classList.remove("current"));let e=this.searchElements[t];e&&(e.classList.add("current"),e.scrollIntoView({behavior:"smooth",block:"center"}))}};var m=null;function D(){return new Promise((a,t)=>{if(m){a(m);return}if(typeof window!="undefined"&&window.pdfjsLib){m=window.pdfjsLib,m.GlobalWorkerOptions.workerSrc||(m.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"),a(m);return}let e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",e.onload=()=>{window.pdfjsLib?(m=window.pdfjsLib,m.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",a(m)):t(new Error("PDF.js failed to load"))},e.onerror=()=>t(new Error("Failed to load PDF.js script")),document.head.appendChild(e)})}var y=class{constructor(t,e){this.pdfDocument=null;this.pages=new Map;this.scale=1;this.textContent=[];this.container=t,this.options=e,this.setupPDFWorker()}loadDocument(t){return p(this,null,function*(){try{let e=yield D(),i;t instanceof File?i=yield this.fileToArrayBuffer(t):i=t;let n=e.getDocument(i);return this.pdfDocument=yield n.promise,yield this.extractTextContent(),yield this.renderAllPages(),this.pdfDocument.numPages}catch(e){throw new Error(`Failed to load PDF: ${e}`)}})}renderAllPages(){return p(this,null,function*(){if(!this.pdfDocument)return;yield new Promise(e=>requestAnimationFrame(e));let t=document.createDocumentFragment();for(let e=1;e<=this.pdfDocument.numPages;e++){let i=yield this.renderPage(e);t.appendChild(i),e%3===0&&(yield new Promise(n=>setTimeout(n,0)))}this.container.innerHTML="",this.container.appendChild(t)})}renderPage(t){return p(this,null,function*(){m||(yield D());let e=yield this.pdfDocument.getPage(t),i=e.getViewport({scale:this.scale}),n=document.createElement("div");n.className="salina-pdf-page",n.setAttribute("data-page-number",t.toString()),n.style.cssText=`
      position: relative;
      display: inline-block;
      margin: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background: white;
    `;let s=document.createElement("canvas"),r=s.getContext("2d");s.width=i.width,s.height=i.height,s.style.display="block",n.appendChild(s),yield e.render({canvasContext:r,viewport:i}).promise;let o=null;(this.options.features.search||this.options.features.highlighting)&&(o=yield this.createTextLayer(e,i,n));let l={pageNumber:t,canvas:s,textLayer:o,scale:this.scale,viewport:i};return this.pages.set(t,l),n})}createTextLayer(t,e,i){return p(this,null,function*(){m||(yield D());let n=yield t.getTextContent(),s=document.createElement("div");return s.className="salina-pdf-text-layer",s.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: auto;
      user-select: text;
    `,n.items.forEach(r=>{let h=m,o=h.Util.transform(h.Util.transform(e.transform,r.transform),[1,0,0,-1,0,0]),l=document.createElement("span");l.textContent=r.str,l.style.cssText=`
        position: absolute;
        left: ${o[4]}px;
        top: ${o[5]}px;
        font-size: ${Math.sqrt(o[0]*o[0]+o[1]*o[1])}px;
        font-family: sans-serif;
        pointer-events: auto;
        user-select: text;
      `,s.appendChild(l)}),i.appendChild(s),s})}setScale(t){this.scale=t,this.updatePageScale()}updatePageScale(){this.isInViewport()?this.renderVisiblePages():this.renderAllPages()}renderVisiblePages(){this.getVisiblePages().forEach(e=>{let i=this.container.querySelector(`[data-page-number="${e}"]`);i&&this.updatePageElement(i,e)})}getVisiblePages(){let t=this.container.getBoundingClientRect(),e=[];return this.pages.forEach((i,n)=>{let s=this.container.querySelector(`[data-page-number="${n}"]`);if(s){let r=s.getBoundingClientRect();r.bottom>=t.top&&r.top<=t.bottom&&e.push(n)}}),e}updatePageElement(t,e){return p(this,null,function*(){let i=yield this.pdfDocument.getPage(e),n=i.getViewport({scale:this.scale}),s=t.querySelector("canvas");if(s){s.width=n.width,s.height=n.height;let r=s.getContext("2d");yield i.render({canvasContext:r,viewport:n}).promise}})}isInViewport(){return this.container.clientHeight>0&&this.container.clientWidth>0}goToPage(t){let e=this.container.querySelector(`[data-page-number="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}calculateFitToWidthScale(){if(!this.pdfDocument||this.pages.size===0)return 1;let t=this.pages.values().next().value,e=this.container.clientWidth-40,i=t.viewport.width;return e/i}calculateFitToHeightScale(){if(!this.pdfDocument||this.pages.size===0)return 1;let t=this.pages.values().next().value,e=this.container.clientHeight-40,i=t.viewport.height;return e/i}getTextContent(){return this.textContent}handleResize(){if(this.options.zoom.fitToWidth){let t=this.calculateFitToWidthScale();this.setScale(t)}else if(this.options.zoom.fitToHeight){let t=this.calculateFitToHeightScale();this.setScale(t)}}destroy(){this.pdfDocument&&this.pdfDocument.destroy(),this.pages.clear(),this.textContent=[]}extractTextContent(){return p(this,null,function*(){if(!this.pdfDocument)return;this.textContent=[];let t=5,e=this.pdfDocument.numPages;for(let i=1;i<=e;i+=t){let n=Math.min(i+t-1,e),s=[];for(let h=i;h<=n;h++)s.push(this.extractPageTextContent(h));let r=yield Promise.all(s);this.textContent.push(...r),n<e&&(yield new Promise(h=>setTimeout(h,0)))}})}extractPageTextContent(t){return p(this,null,function*(){m||(yield D());let e=yield this.pdfDocument.getPage(t),i=yield e.getTextContent(),n=e.getViewport({scale:1});return{pageNumber:t,items:i.items.map(s=>{let r=m,h=r.Util.transform(r.Util.transform(n.transform,s.transform),[1,0,0,-1,0,0]);return{str:s.str,x:h[4],y:h[5],width:s.width,height:s.height}})}})}setupPDFWorker(){}fileToArrayBuffer(t){return p(this,null,function*(){return new Promise((e,i)=>{let n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>i(n.error),n.readAsArrayBuffer(t)})})}};function z(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36)}function oe(a,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>a(...i),t)}}function ae(a,t){let e;return(...i)=>{e||(a(...i),e=!0,setTimeout(()=>e=!1,t))}}function he(a,t,e){return Math.min(Math.max(a,t),e)}function le(a){let t=a.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function ce(a){let t=a.getClientRects();if(t.length===0)throw new Error("Range has no client rects");let e=1/0,i=1/0,n=-1/0,s=-1/0;for(let r=0;r<t.length;r++){let h=t[r];e=Math.min(e,h.left),i=Math.min(i,h.top),n=Math.max(n,h.right),s=Math.max(s,h.bottom)}return new DOMRect(e,i,n-e,s-i)}function B(a,t){let e=URL.createObjectURL(a),i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e)}function ge(a,t,e="application/json"){let i=new Blob([a],{type:e});B(i,t)}function ue(a){return new Promise((t,e)=>{let i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>e(i.error),i.readAsText(a)})}function N(a,t){let e=f({},a);for(let i in t)if(t.hasOwnProperty(i)){let n=t[i],s=e[i];n&&typeof n=="object"&&!Array.isArray(n)&&s&&typeof s=="object"&&!Array.isArray(s)?e[i]=N(s,n):e[i]=n}return e}function q(){return typeof window!="undefined"&&typeof document!="undefined"}function de(){return q()&&("ontouchstart"in window||navigator.maxTouchPoints>0)}function pe(a){let t=["B","KB","MB","GB"],e=a,i=0;for(;e>=1024&&i<t.length-1;)e/=1024,i++;return`${e.toFixed(1)} ${t[i]}`}function U(a){return new Promise(t=>setTimeout(t,a))}function me(a,t=3,e=1e3){return p(this,null,function*(){let i;for(let n=1;n<=t;n++)try{return yield a()}catch(s){if(i=s,n===t)break;let r=e*Math.pow(2,n-1);yield U(r)}throw i})}var k=class extends I.default{constructor(e){super();this.plugins=new Map;this.container=e.container,this.options=this.mergeOptions(e),this.state=this.initializeState(),this.pdfRenderer=new y(this.container,this.options),this.highlightEngine=new w({defaultColor:this.options.highlighting.defaultColor||"rgba(255, 255, 0, 0.4)",allowMultipleColors:this.options.highlighting.allowMultipleColors||!0,persistHighlights:this.options.highlighting.persistHighlights||!0}),this.searchEngine=new x({highlightColor:this.options.search.highlightColor||"rgba(255, 165, 0, 0.6)",caseSensitive:this.options.search.caseSensitive||!1,wholeWords:this.options.search.wholeWords||!1}),this.setupContainer(),this.setupEventListeners(),this.setupResizeObserver(),e.file&&this.loadDocument(e.file)}loadDocument(e){return p(this,null,function*(){var i,n,s,r;try{this.setState({isLoading:!0,error:null});let h=yield this.pdfRenderer.loadDocument(e);this.setState({totalPages:h,currentPage:1,isLoading:!1}),this.emit("document:loaded",h),(n=(i=this.options.callbacks).onLoad)==null||n.call(i,h)}catch(h){let o=h instanceof Error?h:new Error(String(h));throw this.setState({error:o.message,isLoading:!1}),this.emit("document:error",o),(r=(s=this.options.callbacks).onError)==null||r.call(s,o),o}})}destroy(){var e;(e=this.resizeObserver)==null||e.disconnect(),this.pdfRenderer.destroy(),this.highlightEngine.destroy(),this.searchEngine.destroy(),this.removeAllListeners(),this.container.innerHTML=""}goToPage(e){var i,n;e<1||e>this.state.totalPages||(this.setState({currentPage:e}),this.pdfRenderer.goToPage(e),this.emit("page:changed",e,this.state.totalPages),(n=(i=this.options.callbacks).onPageChange)==null||n.call(i,e,this.state.totalPages))}nextPage(){this.goToPage(this.state.currentPage+1)}prevPage(){this.goToPage(this.state.currentPage-1)}zoomIn(){let e=Math.min(this.options.zoom.max,this.state.scale+this.options.zoom.step);this.setZoom(e)}zoomOut(){let e=Math.max(this.options.zoom.min,this.state.scale-this.options.zoom.step);this.setZoom(e)}setZoom(e){var n,s;let i=Math.max(this.options.zoom.min,Math.min(this.options.zoom.max,e));i!==this.state.scale&&(this.state.scale=i,this.highlightEngine.updateScale(i),this.pdfRenderer.setScale(i),this.emit("zoom:changed",i),(s=(n=this.options.callbacks).onZoom)==null||s.call(n,i))}fitToWidth(){if(!this.container)return;let e=this.pdfRenderer.calculateFitToWidthScale();this.setZoom(e)}fitToHeight(){if(!this.container)return;let e=this.pdfRenderer.calculateFitToHeightScale();this.setZoom(e)}search(e){var n,s;if(!e.trim())return this.clearSearch(),[];this.setState({searchQuery:e});let i=this.searchEngine.search(e,this.pdfRenderer.getTextContent());return this.setState({searchResults:i,currentSearchIndex:i.length>0?0:-1}),this.emit("search:results",i),(s=(n=this.options.callbacks).onSearch)==null||s.call(n,i),i}clearSearch(){this.setState({searchQuery:"",searchResults:[],currentSearchIndex:-1}),this.searchEngine.clearResults(),this.emit("search:cleared")}nextSearchResult(){if(this.state.searchResults.length===0)return;let e=(this.state.currentSearchIndex+1)%this.state.searchResults.length;this.setState({currentSearchIndex:e});let i=this.state.searchResults[e];this.goToPage(i.pageNumber)}prevSearchResult(){if(this.state.searchResults.length===0)return;let e=this.state.currentSearchIndex===0?this.state.searchResults.length-1:this.state.currentSearchIndex-1;this.setState({currentSearchIndex:e});let i=this.state.searchResults[e];this.goToPage(i.pageNumber)}addHighlight(e){var n,s;let i=L(f({},e),{id:z(),timestamp:Date.now()});return this.state.highlights.set(i.id,i),this.highlightEngine.addHighlight(i),this.emit("highlight:added",i),(s=(n=this.options.callbacks).onHighlight)==null||s.call(n,i),i}removeHighlight(e){var n,s;let i=this.state.highlights.delete(e);return i&&(this.highlightEngine.removeHighlight(e),this.emit("highlight:removed",e),(s=(n=this.options.callbacks).onHighlightRemove)==null||s.call(n,e)),i}clearHighlights(){this.state.highlights.clear(),this.highlightEngine.clearHighlights(),this.emit("highlight:cleared")}getHighlights(){return Array.from(this.state.highlights.values())}exportHighlights(e="json"){let i=this.getHighlights();if(e==="json")return JSON.stringify(i,null,2);let n=["id","text","pageNumber","x","y","width","height","color","timestamp"],s=i.map(r=>[r.id,`"${r.text.replace(/"/g,'""')}"`,r.pageNumber,r.position.x,r.position.y,r.position.width,r.position.height,r.color,r.timestamp].join(","));return[n.join(","),...s].join(`
`)}importHighlights(e,i="json"){try{let n;if(i==="json")n=JSON.parse(e);else{let r=e.split(`
`).filter(h=>h.trim());if(r.length<2)throw new Error("Invalid CSV format");n=r.slice(1).map(h=>{let o=this.parseCSVLine(h);if(o.length<8)throw new Error("Invalid CSV row format");return{id:o[0],text:o[1].replace(/^"|"$/g,"").replace(/""/g,'"'),pageNumber:parseInt(o[2]),position:{x:parseFloat(o[3]),y:parseFloat(o[4]),width:parseFloat(o[5]),height:parseFloat(o[6])},color:o[7],timestamp:parseInt(o[8])}})}let s=n.filter(r=>r.id&&r.text&&r.pageNumber>0&&r.position&&r.color);s.length!==n.length&&console.warn(`Filtered out ${n.length-s.length} invalid highlights`),this.clearHighlights(),s.forEach(r=>{this.state.highlights.set(r.id,r),this.highlightEngine.addHighlight(r)})}catch(n){throw new Error(`Failed to import highlights: ${n}`)}}parseCSVLine(e){let i=[],n="",s=!1;for(let r=0;r<e.length;r++){let h=e[r];h==='"'?s&&e[r+1]==='"'?(n+='"',r++):s=!s:h===","&&!s?(i.push(n),n=""):n+=h}return i.push(n),i}use(e){if(this.plugins.has(e.name))throw new Error(`Plugin '${e.name}' is already installed`);e.install(this),this.plugins.set(e.name,e)}unuse(e){let i=this.plugins.get(e);i&&(i.uninstall(this),this.plugins.delete(e))}getCurrentPage(){return this.state.currentPage}getTotalPages(){return this.state.totalPages}getScale(){return this.state.scale}getSearchResults(){return this.state.searchResults}getCurrentSearchIndex(){return this.state.currentSearchIndex}isLoading(){return this.state.isLoading}getError(){return this.state.error}mergeOptions(e){var i,n,s,r,h,o,l,g,c,b,v,R,C,S;return{container:e.container,file:(i=e.file)!=null?i:void 0,theme:(n=e.theme)!=null?n:"light",width:(s=e.width)!=null?s:"100%",height:(r=e.height)!=null?r:"100%",features:f({highlighting:!0,search:!0,zoom:!0,export:!0,annotations:!1},e.features),highlighting:f({defaultColor:"rgba(255, 255, 0, 0.4)",allowMultipleColors:!0,persistHighlights:!0},e.highlighting),search:f({highlightColor:"rgba(255, 165, 0, 0.6)",caseSensitive:!1,wholeWords:!1},e.search),zoom:f({min:(o=(h=e.zoom)==null?void 0:h.min)!=null?o:.5,max:(g=(l=e.zoom)==null?void 0:l.max)!=null?g:3,step:(b=(c=e.zoom)==null?void 0:c.step)!=null?b:.2,fitToWidth:(R=(v=e.zoom)==null?void 0:v.fitToWidth)!=null?R:!0,fitToHeight:(S=(C=e.zoom)==null?void 0:C.fitToHeight)!=null?S:!0},e.zoom),callbacks:f({onHighlight:()=>{},onHighlightRemove:()=>{},onSearch:()=>{},onPageChange:()=>{},onLoad:()=>{},onError:()=>{},onZoom:()=>{}},e.callbacks)}}initializeState(){return{currentPage:1,totalPages:0,scale:1,isLoading:!1,error:null,searchQuery:"",searchResults:[],currentSearchIndex:-1,highlights:new Map}}setState(e){Object.assign(this.state,e)}setupContainer(){this.container.classList.add("salina-pdf-viewer"),this.container.setAttribute("data-theme",this.options.theme),typeof this.options.width=="number"?this.container.style.width=`${this.options.width}px`:this.container.style.width=this.options.width,typeof this.options.height=="number"?this.container.style.height=`${this.options.height}px`:this.container.style.height=this.options.height}setupEventListeners(){this.options.features.highlighting&&document.addEventListener("mouseup",()=>this.handleTextSelection()),document.addEventListener("keydown",n=>{if(n.ctrlKey||n.metaKey)switch(n.key){case"f":case"F":this.options.features.search&&(n.preventDefault(),this.emit("search:focus"));break;case"+":case"=":n.preventDefault(),this.zoomIn();break;case"-":n.preventDefault(),this.zoomOut();break;case"0":n.preventDefault(),this.setZoom(1);break}});let e,i=()=>{clearTimeout(e),e=window.setTimeout(()=>{this.options.features.highlighting&&this.highlightEngine.updateVisibleHighlights()},100)};this.container.addEventListener("scroll",i),window.addEventListener("scroll",i),window.addEventListener("resize",()=>{this.options.features.highlighting&&this.highlightEngine.handleViewportChange(),this.pdfRenderer.handleResize()})}setupResizeObserver(){typeof ResizeObserver!="undefined"&&(this.resizeObserver=new ResizeObserver(()=>{this.pdfRenderer.handleResize()}),this.resizeObserver.observe(this.container))}handleTextSelection(){return p(this,null,function*(){var l;let e=window.getSelection();if(!e||!e.toString().trim())return;let i=e.getRangeAt(0),n=e.toString(),s=i.commonAncestorContainer.nodeType===Node.TEXT_NODE?(l=i.commonAncestorContainer.parentElement)==null?void 0:l.closest(".salina-pdf-page"):i.commonAncestorContainer.closest(".salina-pdf-page");if(!s)return;let r=s.getAttribute("data-page-number"),h=parseInt(r||"1"),o=this.highlightEngine.createHighlightFromSelection(e,h,this.options.highlighting.defaultColor);o&&o.forEach(g=>{var c,b;this.state.highlights.set(g.id,g),this.emit("highlight:added",g),(b=(c=this.options.callbacks).onHighlight)==null||b.call(c,g)}),e.removeAllRanges()})}};var E=class{static debounce(t,e){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>t(...n),e)}}static throttle(t,e){let i;return(...n)=>{i||(t(...n),i=!0,setTimeout(()=>i=!1,e))}}static queueTask(t){this.taskQueue.push(t),this.rafId===null&&(this.rafId=requestAnimationFrame(()=>{this.processTasks(),this.rafId=null}))}static processTasks(){this.taskQueue.splice(0).forEach(e=>{try{e()}catch(i){console.error("Task execution error:",i)}})}static createCancellableTimeout(t,e){let i=setTimeout(t,e);return{cancel:()=>clearTimeout(i)}}static measurePerformance(t,e){let i=performance.now(),n=e(),s=performance.now();return console.log(`${t} took ${s-i} milliseconds`),n}static createPerformanceObserver(t){if(typeof PerformanceObserver=="undefined")return null;let e=new PerformanceObserver(i=>{t(i.getEntries())});try{return e.observe({entryTypes:["measure","navigation","paint"]}),e}catch(i){return console.warn("Performance observer not supported:",i),null}}};E.rafId=null,E.taskQueue=[];var P=class{static setCache(t,e){if(this.cache.size>=this.maxCacheSize){let i=this.cache.keys().next().value;this.cache.delete(i)}this.cache.set(t,e)}static getCache(t){return this.cache.get(t)||null}static clearCache(){this.cache.clear()}static getMemoryUsage(){return"memory"in performance?performance.memory:null}static forceGC(){"gc"in window&&typeof window.gc=="function"&&window.gc()}};P.cache=new Map,P.maxCacheSize=50;var O=class{constructor(t,e){this.visibleRange={start:0,end:0};this.totalItems=0;this.container=t,this.itemHeight=e,console.log("VirtualScrolling initialized for container:",t.tagName)}calculateVisibleRange(t,e){let i=Math.floor(t/this.itemHeight),n=Math.ceil(e/this.itemHeight),s=Math.min(i+n+1,this.totalItems-1);return this.visibleRange={start:Math.max(0,i-1),end:s},this.visibleRange}getVisibleRange(){return this.visibleRange}setTotalItems(t){this.totalItems=t}getTotalHeight(){return this.totalItems*this.itemHeight}};var fe="1.0.0";return ne(ve);})();
//# sourceMappingURL=index.global.js.map